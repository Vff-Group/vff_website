{% extends 'base_pages/united_base.html' %}
{% load static %}
{% block content %}



<div class="page-header text-center" style="background-image: url('/static/assets/images/page-header-bg.jpg')">
    <div class="container">
        {% if s_sub_cat_name %}
        <h1 class="page-title">{{s_main_cat_name}}<span>{{s_cat_name}}</span></h1>
        {%else%}
        <h1 class="page-title">{{s_main_cat_name}}<span>All</span></h1>
        {% endif %}
    </div><!-- End .container -->
</div><!-- End .page-header -->
<nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'united_armor:home' %}">{{s_main_cat_name}}</a></li>
            {% if s_sub_cat_name %}
            <li class="breadcrumb-item"><a >{{s_cat_name}}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{s_sub_cat_name}}</li>
            {% endif %}
        </ol>
    </div><!-- End .container -->
</nav><!-- End .breadcrumb-nav -->

<div class="page-content">
    <div class="container">
        <div class="toolbox">
            <div class="toolbox-left">
                <a href="#" class="sidebar-toggler"><i class="icon-bars"></i>Filters</a>
            </div><!-- End .toolbox-left -->

            <div class="toolbox-center">
                <div class="toolbox-info">
                    <span>{{ all_product_data|length }}  </span>  Item
                </div><!-- End .toolbox-info -->
            </div><!-- End .toolbox-center -->

            <div class="toolbox-right">
                <div class="toolbox-sort">
                    <label for="sortby">Sort by:</label>
                    <div class="select-custom">
                        <select name="sortby" id="sortby" class="form-control">
                            <!-- <option value="popularity" selected="selected">Most Popular</option> -->
                            <option value="rating">Most Rated</option>
                            <option value="date">Date</option>
                        </select>
                    </div>
                </div><!-- End .toolbox-sort -->
            </div><!-- End .toolbox-right -->
        </div><!-- End .toolbox -->

        <div class="products">
            <div class="row">
                {% for row in all_product_data%}
                <div class="col-6 col-md-4 col-lg-4 col-xl-3">
                    <div class="product">
                        <figure class="product-media">
                            {% comment %} <span class="product-label label-new">New</span> {% endcomment %}
                            <a href="">
                                <img src="{{row.image}}" alt="Product image" class="product-image">
                            </a>

                            <div class="product-action-vertical">
                                <a href="" class="btn-product-icon btn-wishlist btn-expandable"><span>add to wishlist</span></a>
                            </div><!-- End .product-action -->

                            <div class="product-action ">
                                <form class="add-to-cart-form" method="post" id="add-to-cart-form-{{ row.productid }}" data-product-id="{{ row.productid }}">
                                    {% csrf_token %}
                                    <input type="hidden" name="product_id" value="{{ row.productid }}">
                                    <a href="#" class="btn-product btn-cart" onclick="addToCart('{{ row.productid }}','{{row.default_color_id}}','{{row.size}}','{{row.price}}',1,'{{row.offer_price}}')"><span>add to cart</span></a>
                                </form>
                                
                               
                            </div><!-- End .product-action -->
                        </figure><!-- End .product-media -->

                        <div class="product-body">
                            <div class="product-cat">
                                <a href="">{{row.product_type_name}}</a>
                            </div><!-- End .product-cat -->
                            <h3 class="product-title"><a href="">{{row.product_name}}</a></h3><!-- End .product-title -->

                            <div class="">
                                <span class="old-price">₹{{row.price}} </span>
                                <div class="product-price">₹{{row.offer_price}}</div>
                            </div><!-- End .product-price -->
                            <div class="ratings-container">
                                <div class="ratings">
                                    <div class="ratings-val" style="width: 0%;"></div><!-- End .ratings-val -->
                                </div><!-- End .ratings -->
                                <span class="ratings-text">( {{row.ratings}} Reviews )</span>
                            </div><!-- End .rating-container -->

                            {% comment %} <div class="product-nav product-nav-dots">
                                <a href="" style="background: #cc9966;"><span class="sr-only">Color name</span></a>
                                <a href="" class="active" style="background: #ebebeb;"><span class="sr-only">Color name</span></a>
                            </div><!-- End .product-nav --> {% endcomment %}
                        </div><!-- End .product-body -->
                    </div><!-- End .product -->
                </div><!-- End .col-sm-6 col-lg-4 col-xl-3 -->
                {% endfor %}
                
            </div><!-- End .row -->

            <!-- <div class="load-more-container text-center">
                <a href="#" class="btn btn-outline-darker btn-load-more">More Products <i class="icon-refresh"></i></a>
            </div> -->
            <!-- End .load-more-container -->
        </div><!-- End .products -->

        <div class="sidebar-filter-overlay"></div><!-- End .sidebar-filter-overlay -->
        <aside class="sidebar-shop sidebar-filter">
            <div class="sidebar-filter-wrapper">
                <div class="widget widget-clean">
                    <label><i class="icon-close"></i>Filters</label>
                    <a href="#" class="sidebar-filter-clear">Clean All</a>
                </div><!-- End .widget -->
                
                <div class="widget widget-collapsible">
                    <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true" aria-controls="widget-1">
                            Category
                        </a>
                    </h3><!-- End .widget-title -->

                    <div class="collapse show" id="widget-1">
                        <div class="widget-body">
                            <div class="filter-items filter-items-count">
                               
                                {% for row in product_category_data %}
                                <div class="filter-item">
                                    <div class="custom-control custom-checkbox">
                                        <input type="hidden" value="{{row.product_catid}}">
                                        <input type="checkbox" class="custom-control-input" id="cat-1{{row.product_catid}}">
                                        <label class="custom-control-label" for="cat-1{{row.product_catid}}">{{row.product_category_name}}</label>
                                    </div><!-- End .custom-checkbox -->
                                    <!-- <span class="item-count">3</span> -->
                                </div><!-- End .filter-item -->
                                {% endfor %}
                            </div><!-- End .filter-items -->
                        </div><!-- End .widget-body -->
                    </div><!-- End .collapse -->
                </div><!-- End .widget -->

                <div class="widget widget-collapsible">
                    <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-type" role="button" aria-expanded="true" aria-controls="widget-type">
                            Product Type
                        </a>
                    </h3><!-- End .widget-title -->

                    <div class="collapse show" id="widget-type">
                        <div class="widget-body">
                            <div class="filter-items">
                                {% for row in product_type_data %}
                                <div class="filter-item">
                                    <div class="custom-control custom-checkbox">
                                        <input type="hidden" value="{{row.product_type_id}}">
                                        <input type="checkbox" class="custom-control-input" id="type-1{{row.product_type_id}}">
                                        <label class="custom-control-label" for="type-1{{row.product_type_id}}">{{row.product_type_name}}</label>
                                    </div><!-- End .custom-checkbox -->
                                </div><!-- End .filter-item -->
                                {% endfor %}
                                
                            </div><!-- End .filter-items -->
                        </div><!-- End .widget-body -->
                    </div><!-- End .collapse -->
                </div><!-- End .widget -->

                {% comment %} size filter  {% endcomment %}
                <div class="widget widget-collapsible">
                    <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-2" role="button" aria-expanded="true" aria-controls="widget-2">
                            Size
                        </a>
                    </h3><!-- End .widget-title -->

                    <div class="collapse show" id="widget-2">
                        <div class="widget-body">
                            <div class="filter-items">
                                {% for row in sizes_filter_data %}
                                <div class="filter-item">
                                    <div class="custom-control custom-checkbox">
                                        <input type="hidden" value="{{row.sizes_id}}">
                                        <input type="checkbox" class="custom-control-input" id="size-1{{row.sizes_id}}">
                                        <label class="custom-control-label" for="size-1{{row.sizes_id}}">{{row.size_value}}</label>
                                    </div><!-- End .custom-checkbox -->
                                </div><!-- End .filter-item -->
                                {% endfor %}
                                
                            </div><!-- End .filter-items -->
                        </div><!-- End .widget-body -->
                    </div><!-- End .collapse -->
                </div><!-- End .widget -->

                <div class="widget widget-collapsible">
                    <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-3" role="button" aria-expanded="true" aria-controls="widget-3">
                            Colour
                        </a>
                    </h3><!-- End .widget-title -->

                    <div class="collapse show" id="widget-3">
                        <div class="widget-body">
                            <div class="filter-colors">
                                {% for row in color_filter_data %}
                                <a href="" id="clr{{row.colors_id}}" style="background: #{{row.color_code}};"><span class="sr-only">{{row.color_name}}</span></a>
                                {% endfor %}
                              
                            </div><!-- End .filter-colors -->
                        </div><!-- End .widget-body -->
                    </div><!-- End .collapse -->
                </div><!-- End .widget -->

              
                <div class="widget widget-collapsible">
                    <h3 class="widget-title">
                        <a data-toggle="collapse" href="#widget-5" role="button" aria-expanded="true" aria-controls="widget-5">
                            Price
                        </a>
                    </h3><!-- End .widget-title -->

                    <div class="collapse show" id="widget-5">
                        <div class="widget-body">
                            <div class="filter-price">
                                <div class="filter-price-text">
                                    Price Range:
                                    <span id="filter-price-range"></span>
                                </div><!-- End .filter-price-text -->

                                <div id="price-slider"></div><!-- End #price-slider -->
                            </div><!-- End .filter-price -->
                        </div><!-- End .widget-body -->
                    </div><!-- End .collapse -->
                </div><!-- End .widget -->
                
                
            </div><!-- End .sidebar-filter-wrapper -->
        </aside><!-- End .sidebar-filter -->
    </div><!-- End .container -->
</div><!-- End .page-content -->


<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the filter button and mobile canvas elements
        var filterBtn = document.getElementById('filterBtn');
        var mobileCanvas = document.querySelector('.mobile-canvas');
    
        // Add click event listener to the filter button
        filterBtn.addEventListener('click', function (event) {
            event.stopPropagation(); // Prevent the event from reaching the document click listener
            // Toggle the 'open' class on the mobile canvas
            mobileCanvas.classList.add('open');
            mobileCanvas.classList.remove('close');
            
        });
    
        // Close the mobile canvas when clicking outside it
        document.addEventListener('click', function () {
            mobileCanvas.classList.remove('open');
            mobileCanvas.classList.add('close');
            
        });

           // Close the mobile canvas when clicking outside it
    document.addEventListener('click', function () {
        mobileCanvas.classList.remove('open');
        mobileCanvas.classList.add('close');
    });

    

    // Close the mobile canvas on outside touch
    document.addEventListener('touchstart', function (event) {
        // Check if the touch event target is outside the mobile canvas
        if (!mobileCanvas.contains(event.target) && mobileCanvas.classList.contains('open')) {
            mobileCanvas.classList.remove('open');
            mobileCanvas.classList.add('close');
        }
    });
    
        // Prevent the mobile canvas from closing when clicking inside it
        mobileCanvas.addEventListener('click', function (event) {
            event.stopPropagation(); // Prevent the event from reaching the document click listener
        });
    });
</script> -->

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="..." class="rounded me-2" alt="...">
        <strong class="me-auto">Alert</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body" id="toastMessage">
        <!-- Toast body content will be dynamically updated here -->
      </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function addToCart(productId,color_id,size_id,price,quantity,offer_price) {
        console.log("productId::"+productId)
        $.ajax({
            type: 'POST',
            url: `/united_armor/add_to_cart/${productId}/${color_id}/${size_id}/${price}/${quantity}/${offer_price}/`,  // Replace with the actual URL endpoint where you handle the request on the server
            data: {
                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function(response) {
                console.log('Product added to cart successfully');
                // You can handle the response here if needed
                 // Show the Bootstrap toast with dynamic message
                 $('#toastMessage').html(response.message);
                 $('#liveToast').removeClass('hide').toast('show');
            },
            error: function(error) {
                console.error('Error adding product to cart:', error);
                $('#toastMessage').html(response.message);
                 $('#liveToast').removeClass('hide').toast('show');
            }
        });
    }

    // Hide the toast when the close button is clicked
    $('#liveToast').on('hidden.bs.toast', function() {
        // Perform any actions after the toast is hidden
    });

    function showToast(message, bodyContent) {
        toastr.warning(bodyContent, message, {
          positionClass: "toast-top-center",
          timeOut: 5e3,
          closeButton: !0,
          debug: !1,
          newestOnTop: !0,
          progressBar: !0,
          preventDuplicates: !0,
          onclick: null,
          showDuration: "300",
          hideDuration: "1000",
          extendedTimeOut: "1000",
          showEasing: "swing",
          hideEasing: "linear",
          showMethod: "fadeIn",
          hideMethod: "fadeOut",
          tapToDismiss: !1
      })
    }
</script>

    
{% endblock %}