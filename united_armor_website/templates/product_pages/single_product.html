{% extends 'base_pages/united_base.html' %}
{% load static %}
{% block content %}


<div class="page-content">
    {% if query_result %}
    {% with product=query_result.0 %}
    <div class="product-details-top">
        <div class="bg-light pb-5 mb-4">
            
            <nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
                <div class="container d-flex align-items-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'united_armor:home' %}">Home</a></li>
                        <li class="breadcrumb-item"><a >{{product.main_title_name}}</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{product.cat_name}}</li>
                    </ol>

                    
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->
            
            <div class="container">
                <div class="product-gallery-carousel owl-carousel owl-full owl-nav-dark" id="color-carousel">
                    {% for image in data_images %}
                    <figure class="product-gallery-image" data-color-id="{{ image.color_id_image }}">
                        <img src="{{ image.image_url }}" data-zoom-image="{{ image.image_url }}" alt="product image">
                    </figure><!-- End .product-gallery-image -->
                {% endfor %}
                
                </div><!-- End .owl-carousel -->
            </div><!-- End .container -->
        </div><!-- End .bg-light pb-5 -->

        <div class="product-details product-details-centered product-details-separator">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        
                            <h1 class="product-title" id="product-name">{{ product.product_name }}</h1>

                            <div class="ratings-container">
                                <div class="ratings">
                                    <div class="ratings-val" style="width: 80%;"></div>
                                </div>
                                <a class="ratings-text" href="#product-review-link" id="review-link">( {{ review_data|length }} Reviews )</a>
                            </div>

                            <div class="product-price">
                                <small class="old-price text-sm" id="price">₹{{product.price}} </small>
                            </div>
                            <div class="product-price">
                            <div class="product-price" id="offer-price">₹{{product.offer_price}}</div>
                            </div>

                            <div class="product-content">
                                <p>{{ product.specifications }}</p>
                            </div>
                        


                        <div class="details-filter-row details-row-size">
                            <label>Color:</label>

                            <!-- Add a class to the color links to make it easier to select them with JavaScript -->
                            <div class="product-nav product-nav-dots">
                                {% for color in data_colors %}
                                    <a href="" class="color-link" data-color-id="{{ color.colorsid }}" style="background: #{{ color.color_code }};">
                                        <span class="sr-only">{{ color.color_name }}</span>
                                    </a>
                                {% endfor %}
                            </div><!-- End .product-nav -->

                        </div><!-- End .details-filter-row -->

                        <div class="details-filter-row details-row-size mb-md-2">
                            <label>Size:</label>

                            <div class="product-size">
                               
                                {% for size in data_sizes %}
                                    <a href="" title="size" 
                                    class="{% if size.quantity_available|default_if_none:0 == 0 or size.quantity_available|default_if_none:-1 == 0 %}disabled{% elif size.sizesid == product.default_color_id %}active{% endif %} m-4"
                                    data-size-value="{{ size.size_value }}"
                                    data-size-id="{{ size.sizesid }}"
                                    data-quantity-available="{{ size.quantity_available }}"
                                    data-color-id="{{ size.size_color_id }}">
                                        {{ size.size_value }}
                                    </a>
                                {% endfor %}

                             
                            </div><!-- End .product-size -->
                            <input type="hidden" id="selected-color-id" name="selected-color-id">
                            <input type="hidden" id="selected-size-id" name="selected-size-id">
                            <a href="" class="size-guide" data-bs-toggle="modal" data-bs-target="#sizeGuideModal"><i class="icon-th-list"></i>size guide</a>

                        </div><!-- End .details-filter-row -->
                       
                    </div><!-- End .col-md-6 -->

                    <div class="col-md-6">
                        <div class="product-details-footer details-footer-col">
                            <div class="product-cat">
                                
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a >Product Category </a></li>
                                
                        <li class="breadcrumb-item"><a >{{product.main_title_name}}</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{product.product_type_name}}</li>
                    </ol>
                            </div><!-- End .product-cat -->

                            
                        </div><!-- End .product-details-footer -->
                        <div class="product-details-action">
                            <div class="details-action-col">
                                <div class="product-details-quantity">
                                    <input type="number" id="qty" class="form-control" value="1" min="1" max="{{product.max_checkout_qty}}" step="1" data-decimals="0" required>
                                </div><!-- End .product-details-quantity -->
                                <input type="hidden" id="customer-id" value="{{customer_id}}">
                                <a href="" class="btn-product btn-cart"><span>add to cart</span></a>
                            </div><!-- End .details-action-col -->

                            <div class="details-action-wrapper">
                                <a href="" id="wishlist-btn" class="btn-product btn-wishlist" title="Wishlist"><span>Add to Wishlist</span></a>
                            </div><!-- End .details-action-wrapper -->
                        </div><!-- End .product-details-action -->

                        
                    </div><!-- End .col-md-6 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .product-details -->

        <!-- Add this modal to your HTML for displaying the size guide image -->
        <div class="modal fade" id="sizeGuideModal" tabindex="-1" role="dialog" aria-labelledby="sizeGuideModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="sizeGuideModalLabel">Size Guide</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <img src="{{product.size_guide_image_url}}" alt="Size Guide Image">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Add this modal to your HTML for displaying the login prompt -->
        <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loginModalLabel">Please Log In before using this feature</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    
                    
                </div>
            </div>
        </div>
    </div><!-- End .product-details-top -->

    <div class="container">
        <div class="product-details-tab">
            <ul class="nav nav-pills justify-content-center" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="product-desc-link" data-toggle="tab" href="#product-desc-tab" role="tab" aria-controls="product-desc-tab" aria-selected="true">Description</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-info-link" data-toggle="tab" href="#product-info-tab" role="tab" aria-controls="product-info-tab" aria-selected="false">Fit & Care</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-shipping-link" data-toggle="tab" href="#product-shipping-tab" role="tab" aria-controls="product-shipping-tab" aria-selected="false">Shipping & Returns</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-review-link" data-toggle="tab" href="#product-review-tab" role="tab" aria-controls="product-review-tab" aria-selected="false">Reviews ( {{review_data|length}} )</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="product-desc-tab" role="tabpanel" aria-labelledby="product-desc-link">
                    <div class="product-desc-content">
                        <h3>Product Information</h3>
                        
                        <ul>
                            <ul>
                                {% for spec in product.specifications %}
                                    <li>{{ spec }}</li>
                                {% endfor %}
                            </ul>
                        </ul>

                        
                    </div><!-- End .product-desc-content -->
                </div><!-- .End .tab-pane -->
                <div class="tab-pane fade" id="product-info-tab" role="tabpanel" aria-labelledby="product-info-link">
                    <div class="product-desc-content">
                        <h3>Fit And Care</h3>
                        
                        <ul>
                            {% for desc in product.fit_and_care_desc %}
                            <li>{{ desc }}</li>
                        {% endfor %}
            
                        </ul>

                        
                    </div><!-- End .product-desc-content -->
                </div><!-- .End .tab-pane -->
                <div class="tab-pane fade" id="product-shipping-tab" role="tabpanel" aria-labelledby="product-shipping-link">
                    <div class="product-desc-content">
                        <h3>Delivery & returns</h3>
                        <p></p>
                    </div><!-- End .product-desc-content -->
                </div><!-- .End .tab-pane -->
                <div class="tab-pane fade" id="product-review-tab" role="tabpanel" aria-labelledby="product-review-link">
                    <div class="reviews">
                        <h3>Reviews ( {{review_data|length}} )</h3>
                        {% for row in review_data %}
                        <div class="review">
                            <div class="row no-gutters">
                                <div class="col-auto">
                                    <h4><a >{{row.customer_name}}</a></h4>
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 100%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                    </div><!-- End .rating-container -->
                                    <span class="review-date">{{row.time_review_given}}</span>
                                </div><!-- End .col -->
                                <div class="col">
                                    <div class="review-content">
                                        <p>{{row.comment}}</p>
                                    </div><!-- End .review-content -->
                                </div><!-- End .col-auto -->
                            </div><!-- End .row -->
                        </div><!-- End .review -->
                        {% endfor %}
                    </div><!-- End .reviews -->
                </div><!-- .End .tab-pane -->
            </div><!-- End .tab-content -->
        </div><!-- End .product-details-tab -->
    </div><!-- End .container -->
    {% endwith %}
                    
        {% endif %}
    

    
</div><!-- End .page-content -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
    $(document).ready(function () {
        var selectedColorId = null;
        var selectedSizeId = null;
        // Store all original images in a variable
        var allImages = $('.product-gallery-image').clone();
        var carousel = $('#color-carousel');

        // Initialize the carousel
        initCarousel();

        // Initialize sizes and colors with the data from Django template
        var initialColorId = $('.color-link:first').data('color-id');
        var initialSizeId = $('.product-size a.active').data('size-id');

        // Set the first color and size as active if none is initially selected
        if (!initialColorId) {
            initialColorId = $('.color-link:first').addClass('selected-color').data('color-id');
        }

        if (!initialSizeId) {
            initialSizeId = $('.product-size a:first').addClass('active').data('size-id');
        }

        updateCarouselAndSizes(initialColorId, initialSizeId);

       // Handle mouse enter and click events for colors
        $('.color-link').on('mouseenter click', function (event) {
            event.preventDefault();

            // Remove 'active' class from all color links
            $('.color-link').removeClass('active');

            // Add 'active' class to the clicked color link
            $(this).addClass('active');

            var colorId = $(this).data('color-id');
            selectedColorId = $(this).data('color-id');
            updateCarouselAndSizes(colorId, null);
            // Add 'active' class to the clicked color link
            $(this).addClass('active');
            // Add a class to the clicked color link and remove 'active' from all sizes
            $('.color-link').removeClass('selected-color');
            $(this).addClass('selected-color');
           

            // Update hidden input for color id
            updateColorIdInput();
        });

        // Handle click events for sizes
        $('.product-size').on('click', 'a', function (event) {
            event.preventDefault();
            var sizeColorId = $(this).data('color-id');
            var sizeId = $(this).data('size-id');
            selectedSizeId = $(this).data('size-id');
            console.log('Size clicked for colorId:', sizeColorId, ' and sizeId:', sizeId);

            // Remove the 'active' class from all sizes
            $('.product-size a').removeClass('active');

            // Add 'active' class only to the clicked size
            $(this).addClass('active');

            // Update carousel based on the selected color and size
            var colorId = $('.color-link.selected-color').data('color-id');
            updateCarouselAndSizes(colorId, sizeId);

            // Update hidden input for size id
            updateSizeIdInput();
        });



        // Function to update carousel and sizes based on color id and size id
        function updateCarouselAndSizes(colorId, sizeId) {
            // Destroy the existing carousel
            carousel.trigger('destroy.owl.carousel');
            carousel.empty();

            // Create a copy of the original images
            var originalImages = allImages.clone();

            // Filter images based on the selected color
            var matchingImages = originalImages.filter('[data-color-id="' + colorId + '"]');

            // Append matching images to the carousel
            carousel.append(matchingImages);

            // Reinitialize the carousel
            initCarousel();

            // Update sizes based on the selected color
            updateSizesByColor(colorId);

            // Set the selected size as active
            if (sizeId) {
                $('.product-size a[data-size-id="' + sizeId + '"]').addClass('active');
            }
        }

        // Function to initialize the carousel
        function initCarousel() {
            carousel.owlCarousel({
                // Add your carousel options here
                // For example:
                items: 3,
                loop: true,
                margin: 10,
                nav: true,
                dots: false,
                responsiveClass: true,
                responsive: {
                    0: {
                        items: 1,
                        nav: true
                    },
                    600: {
                        items: 3,
                        nav: false
                    },
                    1000: {
                        items: 3,
                        nav: true,
                        loop: false
                    }
                }
            });

            // Add additional classes after the carousel is initialized
            carousel.addClass('owl-full owl-nav-dark');
        }

        // Function to update sizes based on color id
        function updateSizesByColor(colorId) {
            // Hide all sizes
            $('.product-size a').hide();

            // If there's only one color, show all sizes
            if ($('.color-link').length === 1) {
                $('.product-size a').show();
            } else {
                // Select and show sizes with the specified data-color-id
                $('.product-size a[data-color-id="' + colorId + '"]').show();
            }
        }

         // Handle click events for the size guide
         $('.size-guide').on('click', function (event) {
            event.preventDefault();

            
            $('#sizeGuideModal').modal('show');
        });

        // Function to update hidden input for color id
        function updateColorIdInput() {
            $('#selected-color-id').val(selectedColorId);
        }

        // Function to update hidden input for size id
        function updateSizeIdInput() {
            $('#selected-size-id').val(selectedSizeId);
        }

    });
    
</script>

<!-- <script>
    $(document).ready(function () {
        var selectedColorId = null;
        var selectedSizeId = null;
        // Store all original images in a variable
        var allImages = $('.product-gallery-image').clone();
        var carousel = $('#color-carousel');

        // Initialize the carousel
        initCarousel();

        // Initialize sizes and colors with the data from Django template
        var initialColorId = $('.color-link:first').data('color-id');
        var initialSizeId = $('.product-size a.active').data('size-id');

        // Set the first color and size as active if none is initially selected
        if (!initialColorId) {
            initialColorId = $('.color-link:first').addClass('selected-color').data('color-id');
        }

        if (!initialSizeId) {
            initialSizeId = $('.product-size a:first').addClass('active').data('size-id');
        }

        updateCarouselAndSizes(initialColorId, initialSizeId);

        // Handle mouse enter and click events for colors
        $('.color-link').on('mouseenter click', function (event) {
            event.preventDefault();
            var colorId = $(this).data('color-id');
            selectedColorId = $(this).data('color-id');
            updateCarouselAndSizes(colorId, null);

            // Add a class to the clicked color link
            $('.color-link').removeClass('selected-color');
            $(this).addClass('selected-color');
            // Update hidden input for color id
            updateColorIdInput();
        });

        // Handle click events for sizes
        $('.product-size').on('click', 'a', function (event) {
            event.preventDefault();
            var sizeColorId = $(this).data('color-id');
            var sizeId = $(this).data('size-id');
            selectedSizeId = $(this).data('size-id');
            console.log('Size clicked for colorId:', sizeColorId, ' and sizeId:', sizeId);

            // Remove the 'active' class from all sizes and add it to the clicked size
            $('.product-size a').removeClass('active');
            $(this).addClass('active');

            // Update carousel based on the selected color and size
            var colorId = $('.color-link.selected-color').data('color-id');
             // Update hidden input for size id
             updateSizeIdInput();
           // updateCarouselAndSizes(colorId, sizeId);
        });

        // Function to update carousel and sizes based on color id and size id
        function updateCarouselAndSizes(colorId, sizeId) {
            // Destroy the existing carousel
            carousel.trigger('destroy.owl.carousel');
            carousel.empty();

            // Create a copy of the original images
            var originalImages = allImages.clone();

            // Filter images based on the selected color
            var matchingImages = originalImages.filter('[data-color-id="' + colorId + '"]');

            // Append matching images to the carousel
            carousel.append(matchingImages);

            // Reinitialize the carousel
            initCarousel();

            // Update sizes based on the selected color
            updateSizesByColor(colorId);

            // Set the selected size as active
            if (sizeId) {
                $('.product-size a[data-size-id="' + sizeId + '"]').addClass('active');
            }
        }

        // Function to initialize the carousel
        function initCarousel() {
            carousel.owlCarousel({
                // Add your carousel options here
                // For example:
                items: 3,
                loop: true,
                margin: 10,
                nav: true,
                dots: false,
                responsiveClass: true,
                responsive: {
                    0: {
                        items: 1,
                        nav: true
                    },
                    600: {
                        items: 3,
                        nav: false
                    },
                    1000: {
                        items: 3,
                        nav: true,
                        loop: false
                    }
                }
            });

            // Add additional classes after the carousel is initialized
            carousel.addClass('owl-full owl-nav-dark');
        }

        // Function to update sizes based on color id
        function updateSizesByColor(colorId) {
            // Hide all sizes
            $('.product-size a').hide();

            // If there's only one color, show all sizes
            if ($('.color-link').length === 1) {
                $('.product-size a').show();
            } else {
                // Select and show sizes with the specified data-color-id
                $('.product-size a[data-color-id="' + colorId + '"]').show();
            }
        }

         // Handle click events for the size guide
         $('.size-guide').on('click', function (event) {
            event.preventDefault();

            
            $('#sizeGuideModal').modal('show');
        });

        // Function to update hidden input for color id
        function updateColorIdInput() {
            $('#selected-color-id').val(selectedColorId);
        }

        // Function to update hidden input for size id
        function updateSizeIdInput() {
            $('#selected-size-id').val(selectedSizeId);
        }

    });
</script> -->


<!-- To Handle the Add To Cart Button  -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Add a click event listener to the "Add to Cart" button
        document.querySelector('.btn-cart').addEventListener('click', function (event) {
            event.preventDefault();

            // Get the selected color ID and size ID
            var selectedColorId = document.getElementById('selected-color-id').value;
            var selectedSizeId = document.getElementById('selected-size-id').value;
            var customerId = $('#customer-id').val();

        if (!customerId) {
            // Show the login modal if customer ID is empty
            $('#loginModal').modal('show');
            return;
        }
            if(selectedColorId === ''){
                showToast('Alert','Please Select the Color you want');
                return;
            }
            if(selectedSizeId === ''){
                showToast('Alert','Please Select the Size you want');
                return;
            }
            
            // Get the selected product details
            var productName = $('#product-name').text();
            var selectedColorImage = document.querySelector('.product-gallery-image[data-color-id="' + selectedColorId + '"] img').getAttribute('data-zoom-image');
            var price = $('#price').text().trim();
            var offerPrice = $('#offer-price').text().trim();

            // Get the selected quantity
            var quantity = parseInt(document.getElementById('qty').value);
            
            // Create an object with the selected product details
            var selectedProduct = {
                productName: productName,
                selectedColorImage: selectedColorImage,
                price: price,
                offerPrice: offerPrice,
                selectedColorId: selectedColorId,
                selectedSizeId: selectedSizeId,
                quantity: quantity
            };

            
            console.log(selectedProduct);
        });
    });

    // Wait for the document to be ready
    $(document).ready(function () {
        // Attach a click event handler to the wishlist button
        $('#wishlist-btn').on('click', function (event) {
            // Prevent the default behavior of the anchor tag
            event.preventDefault();
            var customerId = $('#customer-id').val();

            if (!customerId) {
                // Show the login modal if customer ID is empty
                $('#loginModal').modal('show');
                return;
            }
            // Add your custom logic here, e.g., trigger an AJAX request to add to the wishlist
            addToWishlist();
        });

        // Function to handle adding to the wishlist (you can customize this)
        function addToWishlist() {
            // Add your logic here to perform actions when the "Add to Wishlist" button is clicked
            console.log('Adding to Wishlist...');
        }
    });


    // Function to show a toast message
        function showToast(message, bodyContent) {
            toastr.info(bodyContent, message, {
                positionClass: "toast-bottom-right",
                timeOut: 5e3,
                closeButton: !0,
                debug: !1,
                newestOnTop: !0,
                progressBar: !0,
                preventDuplicates: !0,
                onclick: null,
                showDuration: "300",
                hideDuration: "1000",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut",
                tapToDismiss: !1
        })
        }

        function showToastSuccess(message, bodyContent) {
            toastr.success(bodyContent, message, {
                positionClass: "toast-bottom-right",
                timeOut: 5e3,
                closeButton: !0,
                debug: !1,
                newestOnTop: !0,
                progressBar: !0,
                preventDuplicates: !0,
                onclick: null,
                showDuration: "300",
                hideDuration: "1000",
                extendedTimeOut: "1000",
                showEasing: "swing",
                hideEasing: "linear",
                showMethod: "fadeIn",
                hideMethod: "fadeOut",
                tapToDismiss: !1
        })
        }

</script>




<!-- <script>
    $(document).ready(function () {
        // Store all original images in a variable
        var allImages = $('.product-gallery-image').clone();
        var carousel = $('#color-carousel');

        // Initialize the carousel
        initCarousel();

        // Initialize sizes with the first color_id
        var initialColorId = $('.color-link:first').data('color-id');
        updateCarouselAndSizes(initialColorId);

        // Handle mouse enter and click events for colors
        $('.color-link').on('mouseenter click', function (event) {
            event.preventDefault();
            var colorId = $(this).data('color-id');
            updateCarouselAndSizes(colorId);

            // Add a class to the clicked color link
            $('.color-link').removeClass('selected-color');
            $(this).addClass('selected-color');
        });

         // Handle click events for sizes
         $('.product-size').on('click', 'a', function (event) {
            event.preventDefault();

            // Add your logic for handling size click here
            var sizeColorId = $(this).data('color-id');
            console.log('Size clicked for colorId:', sizeColorId);
        });

        // Function to update carousel and sizes based on color id
        function updateCarouselAndSizes(colorId) {
            // Destroy the existing carousel
            carousel.trigger('destroy.owl.carousel');
            carousel.empty();

            // Create a copy of the original images
            var originalImages = allImages.clone();

            // Filter images based on the selected color
            var matchingImages = originalImages.filter('[data-color-id="' + colorId + '"]');

            // Append matching images to the carousel
            carousel.append(matchingImages);

            // Reinitialize the carousel
            initCarousel();

            // Update sizes based on the selected color
            updateSizesByColor(colorId);
        }

        // Function to initialize the carousel
        function initCarousel() {
            carousel.owlCarousel({
                // Add your carousel options here
                // For example:
                items: 3,
                loop: true,
                margin: 10,
                nav: true,
                dots: false,
                responsiveClass: true,
                responsive: {
                    0: {
                        items: 1,
                        nav: true
                    },
                    600: {
                        items: 3,
                        nav: false
                    },
                    1000: {
                        items: 3,
                        nav: true,
                        loop: false
                    }
                }
            });

            // Add additional classes after the carousel is initialized
            carousel.addClass('owl-full owl-nav-dark');
        }

        // Function to update sizes based on color id
        function updateSizesByColor(colorId) {
            // Hide all sizes
            $('.product-size a').hide();

            // If there's only one color, show all sizes
            if ($('.color-link').length === 1) {
                $('.product-size a').show();
            } else {
                // Select and show sizes with the specified data-color-id
                $('.product-size a[data-color-id="' + colorId + '"]').show();
            }
        }
    });
</script> -->





{% endblock %}