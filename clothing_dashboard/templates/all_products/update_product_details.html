{% extends "base/base.html" %}
{% load static %}
{% block title %}Product{% endblock title%}
{% block content %}



  <div class="container-fluid py-4">
    
    <div class="row">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0 d-flex justify-content-between">
            <h6>Add New Product</h6>
            
          </div>

          <div class="card-body px-0 pt-0 pb-2">
            <form method="post" enctype="multipart/form-data" id="new-product-form" action="{% url 'clothing_dashboard_app:update_new_product' main_cat_id cat_id sub_cat_id product_id %}">
                {% csrf_token %}
                <div class="pl-lg-4 m-4">
                    <!-- To Select All Images and Default Image  -->
                    
                    
                    
                    <div class="row mb-4">
                        <div class="col-lg-3">
                            <div class="form-group">
                                <label class="form-control-label" for="input-default-image">Default Image</label>
                                <div id="default-image-dropzone" class="dropzone">
                                    <input type="file" id="input-default-image" class="form-control form-control-alternative" name="default_image" accept=".jpg, .jpeg, .png" style="display:none;" required>
                                    <div class="dz-message needsclick" onclick="document.getElementById('input-default-image').click()">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <h6 class=" text-secondary">Click to upload default image</h6>
                                        <h5 class=" text-secondary text-bolder">765 X 850</h5>
                                        <small class=" text-secondary text-sm-center">Please choose image according to the aspect ratio</small>
                                    </div>
                                </div>
                                <!-- Preview container for default image -->
                                <div id="default-image-preview-container" class="mt-3" style="display: none;">
                                    <img id="default-image-preview" src="#" alt="Default Image Preview" style="width:150px; height: 150px;">
                                    <button type="button" class="btn  btn-outline-danger btn-sm mt-2" onclick="clearDefaultImage()">Clear Image</button>
                                </div>

                                 <!-- Display existing default image -->
                                {% if product_data %}
                                <div id="default-image-preview-container" class="mt-3">
                                    <img id="default-image-preview" src="{{ product_data.0.default_images }}" alt="Default Image Preview" style="width:150px; height: 150px;">
                                    <button type="button" class="btn btn-outline-danger btn-sm mt-2" onclick="clearDefaultImage()">Clear Image</button>
                                </div>
                            {% endif %}
                            </div>
                        </div>
                        <div class="col-lg-9">
                            <div class="form-group">
                                <label class="form-control-label" for="input-images">Product Images</label>
                                <div id="image-dropzone" class="dropzone">
                                    <input type="file" id="input-images" class="form-control form-control-alternative" name="product_images[]" multiple accept=".jpg, .jpeg, .png" style="display:none;" required>
                                    <div class="dz-message needsclick" onclick="document.getElementById('input-images').click()">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <h6 class=" text-secondary">Click to upload product images</h6>
                                        <h5 class=" text-secondary text-bolder">765 X 850</h5>
                                        <small class=" text-secondary">Please choose image according to the aspect ratio</small>
                                    </div>
                                </div>
                                <!-- Preview container for images -->
                                <div id="image-preview-container" class="mt-3"></div>

                                 <!-- Display existing product images -->
                                {% for image in all_images_data %}
                                <img src="{{ image.image_url }}" alt="Product Image" style="width: 150px; height: 150px; margin-right: 5px;">
                            {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- New fields for multiple images, product name, description, fit and care, and return policy -->
                    <div class="row mb-4">
                        
                        <!-- Product Name -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-name">Product Name</label>
                                <input type="text" id="input-product-name" class="form-control form-control-alternative" placeholder="Enter Product Name" name="product_name" autocomplete="off" value="{% if product_data %}{{ product_data.0.product_name }}{% endif %}" required>
                            </div>
                        </div>

                         <!-- Dropdown for Product Type -->
                         {% if p_type_data %}
                            <!-- Access the first item in the list -->
                            {% with first_p_type=p_type_data.0 %}
                                    <!-- Hidden input for selected product type name -->
                                <input type="hidden" id="selected-product-type-name" name="selected_product_type_name" value="{{first_p_type.p_type_name}}">

                                <!-- Hidden input for selected product type ID -->
                                <input type="hidden" id="selected-product-type-id" name="selected_product_type_id"  value="{{first_p_type.p_type_id}}">
                                
                            {% endwith %}
                        {% else %}
                            <!-- Hidden input for selected product type name -->
                            <input type="hidden" id="selected-product-type-name" name="selected_product_type_name" >

                            <!-- Hidden input for selected product type ID -->
                            <input type="hidden" id="selected-product-type-id" name="selected_product_type_id"  >
                        {% endif %}
                        
                         <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-type">Product Type</label>
                                <select id="input-product-type" class="form-control form-control-alternative" name="product_type" required onchange="updateSelectedProductType()">
                                    <option value="" disabled>Select Product Type</option>
                                    <!-- Add options dynamically based on your product types -->
                                    {% for p_type in p_type_data %}
                                    <option value="{{ p_type.p_type_id }}" {% if product_data and p_type.p_type_id == product_data.0.product_type_id %}selected{% endif %}>{{ p_type.p_type_name }}</option>
                                    {% endfor %}
                                {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <!-- Checkboxes for Sizes -->
                        <div class="col-lg-4">
                            <label class="form-control-label">Sizes Available</label>
                            <div class="row">
                                <!-- Hidden input for selected size IDs -->
                                <input type="hidden" id="selected-size-ids" name="selected_size_ids" >

                                <!-- Hidden input for selected size values -->
                                <input type="hidden" id="selected-size-values" name="selected_size_values" >

                                <!-- Add checkboxes dynamically based on your available sizes -->
                                        {% for size in sizes_data %}
                                         <div class="col-lg-3">
                                             <div class="form-check">
                                                 <input class="form-check-input" type="checkbox" id="sizeCheckbox{{ size.size_id }}" name="sizes[]" value="{{ size.size_value }}" data-size-id="{{ size.size_id }}" {% if all_selected_sizes_data and size.size_id in all_selected_sizes_data %}checked{% endif %} onclick="updateSelectedSizes()">
                                                 <label class="form-check-label" for="sizeCheckbox{{ size.size_id }}">{{ size.size_value }}</label>
                                             </div>
                                         </div>
                                     {% endfor %}
                                </div>
                     
                    
                    </div>

                    <div class="row mb-2">
                         <!-- Price -->
                         <div class="col-lg-4">
                            <div class="form-group">
                                <label for="product-Price">Price</label>
                                <input type="number" class="form-control" id="product-Price" name="productPrice" placeholder="Enter product price" required>
                            </div>
                         </div>

                          <!-- Offer Price -->
                          <div class="col-lg-4">
                            <div class="form-group">
                                <label for="product-offer-price">Offer Price %</label>
                                <input type="number" class="form-control" id="product-offer-price" name="productOfferPrice" placeholder="Enter product offer price" required>
                            </div>
                         </div>
                          

                             <!-- Max Checkout Quantity -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label for="productCheckOut-Quantity">Max Checkout Quantity</label>
                                    <input type="number" class="form-control" id="productCheckOut-Quantity" name="productCheckOutQuantity" placeholder="Enter Max Checkout Quantity"  required>
                                </div>
                            </div>
                    </div>

                    <div class="row mb-4">
                        <!-- Color Name -->
                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="form-control-label" for="input-color-name">Color Name</label>
                                <input type="text" id="input-color-name" class="form-control form-control-alternative" placeholder="Enter Color Name" name="color_name" autocomplete="off" required value="{% if product_data %}{{ product_data.0.color_name }}{% endif %}">
                            </div>
                        </div>
                    

                        <!-- Color Code  -->
                        <div class="col-lg-2">
                            <label class="form-control-label" for="input-product-color">Color</label>
                            <input type="color" id="input-product-color" class="form-control form-control-sm rounded" name="colors[]" value="{% if product_data %}{{ product_data.0.color_code }}{% endif %}" required>
                        </div>

                        <!-- Product Category Table -->
                        {% if p_category_data %}
                            <!-- Access the first item in the list -->
                            {% with first_p_type=p_category_data.0 %}
                                    <!-- Hidden input for selected product category collection name -->
                            <input type="hidden" id="selected-product-category-name" name="selected_product_category_name" value="{{first_p_type.p_cat_name}}">

                                <!-- Hidden input for selected product category collection ID -->
                            <input type="hidden" id="selected-product-category-id" name="selected_product_category_id"  value="{{first_p_type.p_cat_id}}">
                                
                            {% endwith %}
                        {% else %}
                            <!-- Hidden input for selected product category collection name -->
                            <input type="hidden" id="selected-product-category-name" name="selected_product_category_name">

                            <!-- Hidden input for selected product category collection ID -->
                            <input type="hidden" id="selected-product-category-id" name="selected_product_category_id">
                        {% endif %}

                        <div class="col-lg-4">
                            <div class="form-group">
                                
                                <label for="productCategory">Product Category</label>
                                <select class="form-control" id="productCategory"  onchange="updateSelectedProductCategory()" required>
                                    <option value="" disabled>Select Product Category</option>
                                    {% for p_category in p_category_data %}
                                    <option value="{{ p_category.p_cat_id }}" {% if product_data and p_category.p_cat_id == product_data.0.product_category_id %}selected{% endif %}>{{ p_category.p_cat_name }}</option>
                                    {% endfor %}
                                    
                                </select>
                            </div>
                        </div>

                         <!-- Fitting -->

                         {% if p_fitting_data %}
                            <!-- Access the first item in the list -->
                            {% with first_p_type=p_fitting_data.0 %}
                                    <!-- Hidden input for selected product fitting name -->
                            <input type="hidden" id="selected-product-fitting-name" name="selected_product_fitting_name" value="{{first_p_type.p_fitting_name}}">

                                <!-- Hidden input for selected product fitting ID -->
                            <input type="hidden" id="selected-product-fitting-id" name="selected_product_fitting_id" value="{{first_p_type.p_fitting_id}}">
                                
                            {% endwith %}
                        {% else %}
                            <!-- Hidden input for selected product fitting name -->
                            <input type="hidden" id="selected-product-fitting-name" name="selected_product_fitting_name">

                            <!-- Hidden input for selected product fitting ID -->
                            <input type="hidden" id="selected-product-fitting-id" name="selected_product_fitting_id">
                        {% endif %}
                        

                         <div class="col-lg-4">
                            <div class="form-group">
                                
                                <label for="fittingCategory">Fitting</label>
                                <select class="form-control" id="fittingCategory"  onchange="updateSelectedProductFitting()" required>
                                    <option value="" disabled>Select Product Fitting</option>
                                    {% for p_fitting in p_fitting_data %}
                                    <option value="{{ p_fitting.p_fitting_id }}" {% if product_data and p_fitting.p_fitting_id == product_data.0.fitting_id %}selected{% endif %}>{{ p_fitting.p_fitting_name }}</option>
                                {% endfor %}
                                    
                                </select>
                            </div>
                         </div>

                    </div>

                   
                    <!-- Description, Fit and Care, and Return Policy Textareas -->
                    <div class="row mb-4">
                        <!-- Product Description -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-description">Product Description</label>
                                <textarea id="input-product-description" class="form-control form-control-alternative" placeholder="Enter Product Description" name="product_description" rows="3" required>{% if product_data %}{{ product_data.0.description }}{% endif %}</textarea>
                            </div>
                        </div>

                        <!-- Fit and Care Information -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-fit-care">Fit and Care Information</label>
                                <textarea id="input-fit-care" class="form-control form-control-alternative" placeholder="Enter Fit and Care Information" name="fit_care" rows="3" required>{% if product_data %}{{ product_data.0.fit_and_care }}{% endif %}</textarea>
                            </div>
                        </div>

                        <!-- Short Description -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-what-it-does">Short Description</label>
                                <textarea id="input-what-it-does" class="form-control form-control-alternative" placeholder="Enter Short Description" name="what_it_does" rows="3" required>{% if product_data %}{{ product_data.0.short_description }}{% endif %}</textarea>
                            </div>
                        </div>

                        <!-- Return Policy-->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-return-policy">Return Policy</label>
                                <textarea id="input-return-policy" class="form-control form-control-alternative" placeholder="Enter Return Policy" name="return_policy" rows="3" required>{% if product_data %}{{ product_data.0.return_policy }}{% endif %}</textarea>
                            </div>
                        </div>

                        
                    </div>
        
                    <!-- Existing form fields... -->
                    <div class="row justify-content-end">
                        <div class="col-lg-12 d-flex align-items-end">
                            <button type="submit" class="btn btn-bg-outline-warning">Update Product</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Include jscolor library from CDN -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.5/jscolor.min.js"></script>
        <!-- Include Dropzone.js library -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dropzone@5.9.2/dist/dropzone.css">
        <script src="https://cdn.jsdelivr.net/npm/dropzone@5.9.2/dist/dropzone.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>

        <script>
            function updateSelectedProductType() {
                var selectElement = document.getElementById('input-product-type');
                var selectedOption = selectElement.options[selectElement.selectedIndex];
        
                // Update hidden input fields
                document.getElementById('selected-product-type-name').value = selectedOption.text;
                document.getElementById('selected-product-type-id').value = selectedOption.value;
            }
            
            function updateSelectedProductCategory() {
                var selectElement = document.getElementById('productCategory');
                var selectedOption = selectElement.options[selectElement.selectedIndex];
        
                // Update hidden input fields
                document.getElementById('selected-product-category-name').value = selectedOption.text;
                document.getElementById('selected-product-category-id').value = selectedOption.value;
            }

            function updateSelectedProductFitting() {
                var selectElement = document.getElementById('fittingCategory');
                var selectedOption = selectElement.options[selectElement.selectedIndex];
        
                // Update hidden input fields
                document.getElementById('selected-product-fitting-name').value = selectedOption.text;
                document.getElementById('selected-product-fitting-id').value = selectedOption.value;
            }

            function updateSelectedSizes() {
                var selectedSizeIds = [];
                var selectedSizeValues = [];
        
                // Iterate over all checkboxes
                document.querySelectorAll('input[name="sizes[]"]:checked').forEach(function (checkbox) {
                    selectedSizeIds.push(checkbox.getAttribute('data-size-id'));
                    selectedSizeValues.push(document.querySelector('label[for="' + checkbox.id + '"]').textContent);
                });
        
                // Update hidden input fields
                document.getElementById('selected-size-ids').value = selectedSizeIds.join(',');
                document.getElementById('selected-size-values').value = selectedSizeValues.join(', ');
            }
        </script>
        <script>
            //Default Image Select Code
            document.getElementById('input-default-image').addEventListener('change', function () {
                var input = this;
                var previewContainer = document.getElementById('default-image-preview-container');
                var previewImage = document.getElementById('default-image-preview');
        
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
        
                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                        previewContainer.style.display = 'block';
                    };
        
                    reader.readAsDataURL(input.files[0]);
                }
            });
        
            function clearDefaultImage() {
                var input = document.getElementById('input-default-image');
                var previewContainer = document.getElementById('default-image-preview-container');
                var previewImage = document.getElementById('default-image-preview');
        
                input.value = ''; // Clear the input value
                previewImage.src = '#'; // Clear the preview
                previewContainer.style.display = 'none'; // Hide the preview container
            }
            //Default Image Select Code End

            document.getElementById('input-images').addEventListener('change', function () {
                previewImages(this);
            });
        
            function previewImages(input) {
                var previewContainer = document.getElementById('image-preview-container');
                previewContainer.innerHTML = ''; // Clear previous previews
        
                var files = input.files;
                for (var i = 0; i < files.length; i++) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var imageElement = document.createElement('img');
                        imageElement.src = e.target.result;
                        imageElement.className = 'preview-image';
                        imageElement.style.width='100px';
                        imageElement.style.height='100px';
                        imageElement.style.marginRight='10px';
                        imageElement.style.objectFit='contain';
                        previewContainer.appendChild(imageElement);
                    };
                    reader.readAsDataURL(files[i]);
                }
            }

            // Function to show a toast message
function showToast(message, bodyContent) {
    toastr.warning(bodyContent, message, {
      positionClass: "toast-top-center",
      timeOut: 5e3,
      closeButton: !0,
      debug: !1,
      newestOnTop: !0,
      progressBar: !0,
      preventDuplicates: !0,
      onclick: null,
      showDuration: "300",
      hideDuration: "1000",
      extendedTimeOut: "1000",
      showEasing: "swing",
      hideEasing: "linear",
      showMethod: "fadeIn",
      hideMethod: "fadeOut",
      tapToDismiss: !1
  })
}
        </script>
        
       

        <!-- <script>
            // Customize the appearance and behavior of Dropzone
            Dropzone.autoDiscover = false;
        
            // Initialize Dropzone on the specified element
            var myDropzone = new Dropzone("#image-dropzone", {
                url: "/your-upload-endpoint",
                paramName: "file", // The name that will be used to transfer the file
                maxFilesize: 5, // MB
                maxFiles: 10,
                acceptedFiles: "image/*",
                addRemoveLinks: true, // Add remove links for uploaded files
                dictRemoveFile: "Remove", // Label for the remove link
                init: function () {
                    this.on("addedfile", function (file) {
                        // Display the file preview in the preview container
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var imageElement = document.createElement("img");
                            imageElement.src = e.target.result;
                            document.getElementById("image-preview-container").appendChild(imageElement);
                        };
                        reader.readAsDataURL(file);
                    });
        
                    this.on("removedfile", function (file) {
                        // Remove the file preview from the preview container
                        var previewContainer = document.getElementById("image-preview-container");
                        var previews = previewContainer.getElementsByTagName("img");
                        for (var i = 0; i < previews.length; i++) {
                            if (previews[i].src.includes(file.dataURL)) {
                                previewContainer.removeChild(previews[i]);
                                break;
                            }
                        }
                    });
                },
            });
        </script> -->
        
        <script>
           // Function to preview selected images
          //function previewImages(input) {
          //    var previewContainer = document.getElementById('image-preview-container');
          //    previewContainer.innerHTML = ''; // Clear previous previews

          //    if (input.files) {
          //        for (var i = 0; i < input.files.length; i++) {
          //            var reader = new FileReader();
          //            reader.onload = function (e) {
          //                var imgElement = document.createElement('img');
          //                imgElement.src = e.target.result;
          //                imgElement.className = 'img-thumbnail';
          //                imgElement.style.width = '100px'; // Set the fixed width
          //                imgElement.style.height = '100px'; // Set the fixed height
          //                imgElement.style.marginRight = '5px'; // Set the fixed height
          //                previewContainer.appendChild(imgElement);
          //            };
          //            reader.readAsDataURL(input.files[i]);
          //        }
          //    }
          //}

          //// Attach the previewImages function to the change event of the image input
          //document.getElementById('input-images').addEventListener('change', function () {
          //    previewImages(this);
          //});

           
            // Function to add a new color input field
          // function addColorInput() {
          //     var colorInputContainer = document.getElementById('color-input-container');
        
          //     // Create a new color input field
          //     var newColorInput = document.createElement('div');
          //     newColorInput.className = 'input-group mb-3 me-3';
        
          //     // Color input field using HTML color picker
          //     var inputField = document.createElement('input');
          //     inputField.type = 'color';
          //     inputField.className = 'form-control form-control-sm rounded';
          //     inputField.name = 'colors[]';
          //     inputField.required = true;
        
          //     // Delete button
          //     var deleteButton = document.createElement('button');
          //     deleteButton.type = 'button';
          //     deleteButton.className = 'btn btn-outline-danger rounded-start';
          //     deleteButton.textContent = '-';
          //     deleteButton.addEventListener('click', function() {
          //         removeColorInput(newColorInput);
          //     });
        
          //     // Append elements to the new color input field
          //     newColorInput.appendChild(inputField);
          //     newColorInput.appendChild(deleteButton);
        
          //     // Append the new color input field to the container
          //     colorInputContainer.appendChild(newColorInput);
          // }
        
          // // Function to remove a color input field
          // function removeColorInput(element) {
          //     var colorInputContainer = document.getElementById('color-input-container');
          //     colorInputContainer.removeChild(element);
          // }
        </script>

        <script>
            // Function to add a new color input field
            function addColorInput() {
                var colorInputContainer = document.getElementById('color-input-container');
        
                // Create a new color input field
                var newColorInput = document.createElement('div');
                newColorInput.className = 'input-group mb-3 me-3';
        
                // Color input field using HTML color picker
                var inputField = document.createElement('input');
                inputField.type = 'color';
                inputField.className = 'form-control form-control-sm rounded';
                inputField.name = 'colors[]';
                inputField.required = true;
        
                // Delete button with Flaticon or other delete icon
                var deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-outline-danger rounded-start';
                // Use the Flaticon or other delete icon here
                deleteButton.innerHTML = '<i class="fas fa-trash-alt delete-icon"></i>';
                deleteButton.addEventListener('click', function() {
                    removeColorInput(newColorInput);
                });
        
                // Append elements to the new color input field
                newColorInput.appendChild(inputField);
                newColorInput.appendChild(deleteButton);
        
                // Append the new color input field to the container
                colorInputContainer.appendChild(newColorInput);
            }
        
            // Function to remove a color input field
            function removeColorInput(element) {
                var colorInputContainer = document.getElementById('color-input-container');
                colorInputContainer.removeChild(element);
            }
        </script>
        

        
          
          
    {% endblock  %}        