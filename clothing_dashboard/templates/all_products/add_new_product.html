{% extends "base/base.html" %}
{% load static %}
{% block title %}Product{% endblock title%}
{% block content %}



  <div class="container-fluid py-4">
    
    <div class="row">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0 d-flex justify-content-between">
            <h6>Add New Product</h6>
            
          </div>

          <div class="card-body px-0 pt-0 pb-2">
            <form method="post" enctype="multipart/form-data" id="new-product-form" action="{% url 'clothing_dashboard_app:add_new_product' %}">
                {% csrf_token %}
                <div class="pl-lg-4 m-4">
                    <!-- Existing form fields... -->
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label class="form-control-label" for="input-images">Product Images</label>
                            <div id="image-dropzone" class="dropzone">
                                <input type="file" id="input-images" class="form-control form-control-alternative" name="product_images[]" multiple accept=".jpg, .jpeg, .png" style="display:none;" required>
                                <div class="dz-message needsclick" onclick="document.getElementById('input-images').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <h5>Click to upload product images</h5>
                                </div>
                            </div>
                            <!-- Preview container for images -->
                            <div id="image-preview-container" class="mt-3"></div>
                        </div>
                    </div>
                    
                    <!-- New fields for multiple images, product name, description, fit and care, and return policy -->
                    <div class="row mb-4">
                        
                        <!-- Product Name -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-name">Product Name</label>
                                <input type="text" id="input-product-name" class="form-control form-control-alternative" placeholder="Enter Product Name" name="product_name" autocomplete="off" required>
                            </div>
                        </div>

                         <!-- Dropdown for Product Type -->
                         <!-- Hidden input for selected product type name -->
                        <input type="hidden" id="selected-product-type-name" name="selected_product_type_name">

                        <!-- Hidden input for selected product type ID -->
                        <input type="hidden" id="selected-product-type-id" name="selected_product_type_id">
                         <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-type">Product Type</label>
                                <select id="input-product-type" class="form-control form-control-alternative" name="product_type" required onchange="updateSelectedProductType()">
                                    <option value="" disabled>Select Product Type</option>
                                    <!-- Add options dynamically based on your product types -->
                                    {% for p_type in p_type_data %}
                                    <option value="{{ p_type.p_type_id }}">{{ p_type.p_type_name }}</option>
                                {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <!-- Checkboxes for Sizes -->
                        <div class="col-lg-4">
                            <label class="form-control-label">Sizes Available</label>
                            <div class="row">
                                <!-- Hidden input for selected size IDs -->
                                <input type="hidden" id="selected-size-ids" name="selected_size_ids">

                                <!-- Hidden input for selected size values -->
                                <input type="hidden" id="selected-size-values" name="selected_size_values">

                                <!-- Add checkboxes dynamically based on your available sizes -->
                                {% for size in sizes_data %}
                                <div class="col-lg-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="sizeCheckbox{{ size.size_id }}" name="sizes[]" value="{{ size.size_value }} " onclick="updateSelectedSizes()">
                                        <label class="form-check-label" for="sizeCheckbox{{ size.size_id }}">{{ size.size_value }}</label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                     
                    
                    </div>

                    <div class="row mb-2">
                         <!-- Price -->
                         <div class="col-lg-4">
                            <div class="form-group">
                                <label for="productPrice">Price</label>
                                <input type="number" class="form-control" id="productPrice" placeholder="Enter product price" required>
                            </div>
                         </div>

                          <!-- Offer Price -->
                          <div class="col-lg-4">
                            <div class="form-group">
                                <label for="productOfferPrice">Offer Price %</label>
                                <input type="number" class="form-control" id="productOfferPrice" placeholder="Enter product offer price" required>
                            </div>
                         </div>
                          

                             <!-- Max Checkout Quantity -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label for="productCheckOutQuantity">Max Checkout Quantity</label>
                                    <input type="number" class="form-control" id="productCheckOutQuantity" placeholder="Enter Max Checkout Quantity" required>
                                </div>
                            </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-lg-4">
                            <label class="form-control-label" for="input-product-color">Color</label>
                        <input type="color" id="input-product-color" class="form-control form-control-sm rounded" name="colors[]" required>
                        </div>

                        <!-- Product Category Table -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label for="productCategory">Product Category</label>
                                <select class="form-control" id="productCategory" required>
                                    <option value="" disabled>Select Product Category</option>
                                    {% for p_category in p_category_data %}
                                    <option value="{{ p_category.p_cat_id }}">{{ p_category.p_cat_name }}</option>
                                {% endfor %}
                                    
                                </select>
                            </div>
                        </div>

                         <!-- Fitting -->
                         <div class="col-lg-4">
                            <div class="form-group">
                                <label for="fittingCategory">Fitting</label>
                                <select class="form-control" id="fittingCategory" required>
                                    <option value="" disabled>Select Product Fitting</option>
                                    {% for p_fitting in p_fitting_data %}
                                    <option value="{{ p_fitting.p_fitting_id }}">{{ p_fitting.p_fitting_name }}</option>
                                {% endfor %}
                                    
                                </select>
                            </div>
                         </div>

                    </div>

                   
                    <!-- Description, Fit and Care, and Return Policy Textareas -->
                    <div class="row mb-4">
                        <!-- Product Description -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-product-description">Product Description</label>
                                <textarea id="input-product-description" class="form-control form-control-alternative" placeholder="Enter Product Description" name="product_description" rows="3" required></textarea>
                            </div>
                        </div>
        
                        <!-- Fit and Care Information -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-fit-care">Fit and Care Information</label>
                                <textarea id="input-fit-care" class="form-control form-control-alternative" placeholder="Enter Fit and Care Information" name="fit_care" rows="3" required></textarea>
                            </div>
                        </div>
        
                        <!-- Return Policy -->
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="form-control-label" for="input-return-policy">Return Policy</label>
                                <textarea id="input-return-policy" class="form-control form-control-alternative" placeholder="Enter Return Policy" name="return_policy" rows="3" required></textarea>
                            </div>
                        </div>
                    </div>
        
                    <!-- Existing form fields... -->
                    <div class="row justify-content-end">
                        <div class="col-lg-12 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary">Add New Product</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Include jscolor library from CDN -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.5/jscolor.min.js"></script>
        <!-- Include Dropzone.js library -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dropzone@5.9.2/dist/dropzone.css">
        <script src="https://cdn.jsdelivr.net/npm/dropzone@5.9.2/dist/dropzone.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>

        <script>
            function updateSelectedProductType() {
                var selectElement = document.getElementById('input-product-type');
                var selectedOption = selectElement.options[selectElement.selectedIndex];
        
                // Update hidden input fields
                document.getElementById('selected-product-type-name').value = selectedOption.text;
                document.getElementById('selected-product-type-id').value = selectedOption.value;
            }
            function updateSelectedSizes() {
                var selectedSizeIds = [];
                var selectedSizeValues = [];
        
                // Iterate over all checkboxes
                document.querySelectorAll('input[name="sizes[]"]:checked').forEach(function (checkbox) {
                    selectedSizeIds.push(checkbox.value);
                    selectedSizeValues.push(document.querySelector('label[for="' + checkbox.id + '"]').textContent);
                });
        
                // Update hidden input fields
                document.getElementById('selected-size-ids').value = selectedSizeIds.join(',');
                document.getElementById('selected-size-values').value = selectedSizeValues.join(', ');
            }
        </script>
        <script>
            

            document.getElementById('input-images').addEventListener('change', function () {
                previewImages(this);
            });
        
            function previewImages(input) {
                var previewContainer = document.getElementById('image-preview-container');
                previewContainer.innerHTML = ''; // Clear previous previews
        
                var files = input.files;
                for (var i = 0; i < files.length; i++) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var imageElement = document.createElement('img');
                        imageElement.src = e.target.result;
                        imageElement.className = 'preview-image';
                        imageElement.style.width='100px';
                        imageElement.style.height='100px';
                        imageElement.style.marginRight='10px';
                        imageElement.style.objectFit='contain';
                        previewContainer.appendChild(imageElement);
                    };
                    reader.readAsDataURL(files[i]);
                }
            }

            // Function to show a toast message
function showToast(message, bodyContent) {
    toastr.warning(bodyContent, message, {
      positionClass: "toast-top-center",
      timeOut: 5e3,
      closeButton: !0,
      debug: !1,
      newestOnTop: !0,
      progressBar: !0,
      preventDuplicates: !0,
      onclick: null,
      showDuration: "300",
      hideDuration: "1000",
      extendedTimeOut: "1000",
      showEasing: "swing",
      hideEasing: "linear",
      showMethod: "fadeIn",
      hideMethod: "fadeOut",
      tapToDismiss: !1
  })
}
        </script>
        
       

        <!-- <script>
            // Customize the appearance and behavior of Dropzone
            Dropzone.autoDiscover = false;
        
            // Initialize Dropzone on the specified element
            var myDropzone = new Dropzone("#image-dropzone", {
                url: "/your-upload-endpoint",
                paramName: "file", // The name that will be used to transfer the file
                maxFilesize: 5, // MB
                maxFiles: 10,
                acceptedFiles: "image/*",
                addRemoveLinks: true, // Add remove links for uploaded files
                dictRemoveFile: "Remove", // Label for the remove link
                init: function () {
                    this.on("addedfile", function (file) {
                        // Display the file preview in the preview container
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            var imageElement = document.createElement("img");
                            imageElement.src = e.target.result;
                            document.getElementById("image-preview-container").appendChild(imageElement);
                        };
                        reader.readAsDataURL(file);
                    });
        
                    this.on("removedfile", function (file) {
                        // Remove the file preview from the preview container
                        var previewContainer = document.getElementById("image-preview-container");
                        var previews = previewContainer.getElementsByTagName("img");
                        for (var i = 0; i < previews.length; i++) {
                            if (previews[i].src.includes(file.dataURL)) {
                                previewContainer.removeChild(previews[i]);
                                break;
                            }
                        }
                    });
                },
            });
        </script> -->
        
        <script>
           // Function to preview selected images
          //function previewImages(input) {
          //    var previewContainer = document.getElementById('image-preview-container');
          //    previewContainer.innerHTML = ''; // Clear previous previews

          //    if (input.files) {
          //        for (var i = 0; i < input.files.length; i++) {
          //            var reader = new FileReader();
          //            reader.onload = function (e) {
          //                var imgElement = document.createElement('img');
          //                imgElement.src = e.target.result;
          //                imgElement.className = 'img-thumbnail';
          //                imgElement.style.width = '100px'; // Set the fixed width
          //                imgElement.style.height = '100px'; // Set the fixed height
          //                imgElement.style.marginRight = '5px'; // Set the fixed height
          //                previewContainer.appendChild(imgElement);
          //            };
          //            reader.readAsDataURL(input.files[i]);
          //        }
          //    }
          //}

          //// Attach the previewImages function to the change event of the image input
          //document.getElementById('input-images').addEventListener('change', function () {
          //    previewImages(this);
          //});

           
            // Function to add a new color input field
          // function addColorInput() {
          //     var colorInputContainer = document.getElementById('color-input-container');
        
          //     // Create a new color input field
          //     var newColorInput = document.createElement('div');
          //     newColorInput.className = 'input-group mb-3 me-3';
        
          //     // Color input field using HTML color picker
          //     var inputField = document.createElement('input');
          //     inputField.type = 'color';
          //     inputField.className = 'form-control form-control-sm rounded';
          //     inputField.name = 'colors[]';
          //     inputField.required = true;
        
          //     // Delete button
          //     var deleteButton = document.createElement('button');
          //     deleteButton.type = 'button';
          //     deleteButton.className = 'btn btn-outline-danger rounded-start';
          //     deleteButton.textContent = '-';
          //     deleteButton.addEventListener('click', function() {
          //         removeColorInput(newColorInput);
          //     });
        
          //     // Append elements to the new color input field
          //     newColorInput.appendChild(inputField);
          //     newColorInput.appendChild(deleteButton);
        
          //     // Append the new color input field to the container
          //     colorInputContainer.appendChild(newColorInput);
          // }
        
          // // Function to remove a color input field
          // function removeColorInput(element) {
          //     var colorInputContainer = document.getElementById('color-input-container');
          //     colorInputContainer.removeChild(element);
          // }
        </script>

        <script>
            // Function to add a new color input field
            function addColorInput() {
                var colorInputContainer = document.getElementById('color-input-container');
        
                // Create a new color input field
                var newColorInput = document.createElement('div');
                newColorInput.className = 'input-group mb-3 me-3';
        
                // Color input field using HTML color picker
                var inputField = document.createElement('input');
                inputField.type = 'color';
                inputField.className = 'form-control form-control-sm rounded';
                inputField.name = 'colors[]';
                inputField.required = true;
        
                // Delete button with Flaticon or other delete icon
                var deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-outline-danger rounded-start';
                // Use the Flaticon or other delete icon here
                deleteButton.innerHTML = '<i class="fas fa-trash-alt delete-icon"></i>';
                deleteButton.addEventListener('click', function() {
                    removeColorInput(newColorInput);
                });
        
                // Append elements to the new color input field
                newColorInput.appendChild(inputField);
                newColorInput.appendChild(deleteButton);
        
                // Append the new color input field to the container
                colorInputContainer.appendChild(newColorInput);
            }
        
            // Function to remove a color input field
            function removeColorInput(element) {
                var colorInputContainer = document.getElementById('color-input-container');
                colorInputContainer.removeChild(element);
            }
        </script>
        

        
          
          
    {% endblock  %}        