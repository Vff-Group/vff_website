{% extends "common/base.html" %}
{% load static %}
{% block title %}Orders Details{% endblock title%}
{% block content %}

  <div class="container-fluid py-4">
<!-- Payment Modal -->
<div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" id="modal-default1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form id="order-form" method="post" action="">
        {% csrf_token %}
        <div class="modal-body">
          <h6 class="heading-small text-muted mb-4">
            Payment Details
          </h6>
          <div class="pl-lg-4">
            <div class="row">
              <div class="col">
              <div class="row">
                <div id="delivery-charges-container" class="col-lg-6">
                  
                  <!-- This is to add delivery charges -->
                  
                    <div class="form-group">
                      <label
                        for="delivery-label"
                        class="form-control-label"
                        >Delivery Charges </label
                      >
                      <input
                        class="form-control form-control-alternative"
                        type="number"
                        id="delivery-input"
                        name="delivery-value"
                        value=""
                        placeholder="Enter delivery charges"
                        autocomplete="off"
                      />
                    </div>
                  
              </div>
              
              <div class="col-lg-6">
                <div class="form-group">
                  <label
                    for="discount-label"
                    class="form-control-label"
                    >Discounts *</label
                  >
                  <input
                    class="form-control form-control-alternative"
                    type="number"
                    id="discounted-input"
                    name="discount-value"
                    value=""
                    placeholder="Enter if any discount"
                    autocomplete="off"
                  />
                </div>
              </div>
              </div>

            <hr />
            <div class="container" id="gst-container">
              <div class="row">
                <div class="col-lg-5">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeGST" name="includeGST">
                    <label class="form-check-label" for="includeGST">Include GST</label>
                  </div>
                </div>
            
                <div class="col-lg-2 text-center">
                  <span class="or-label">OR</span>
                </div>
            
                <div class="col-lg-5">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeIGST" name="includeIGST">
                    <label class="form-check-label" for="includeIGST">Include IGST</label>
                  </div>
                </div>
              </div>
              <hr />
            </div>
            
            <div class="row">
              <div class="col-lg-6">
                <p class="mb-0"><small>Sub Total:</small></p>
                <p class="mb-0"><small>Addon:</small></p>
                <p class="mb-0"><small>Delivery Charges:</small></p>
                <p class="mb-0"><small>Discount (%):</small></p>
                <p class="mb-0"><small>Tax(18%):</small></p>
              </div>
              <div
                class="col-lg-6 d-flex flex-column align-items-end"
              >
                <p class="mb-0"><small id="sub-total">Rs.{{sub_total}}-</small></p>
                <input
                            class="form-control form-control-alternative"
                            type="hidden"
                            id="subtotal"
                            
                            value="{{sub_total}}"
                        />
                        <input
                            class="form-control form-control-alternative"
                            type="hidden"
                            id="orderid"
                            
                            value="{{order_id}}"
                        />
                <p class="mb-0"><small id="addons-total">Rs.0/-</small></p>
                <p class="mb-0"><small id="delivery-charges">Rs.0/-</small></p>
                <p class="mb-0"><small id="discount-amount">Rs.0/-</small></p>
                <p class="mb-0"><small id="tax-total">Rs.0/-</small></p>
              </div>
            </div>
            <hr />
            <div class="row">
              <div class="col-lg-6"><h6>Gross Total</h6></div>
              <div
                class="col-lg-6 d-flex flex-column align-items-end"
              >
                <h6 id="gross-total">Rs 0</h6>
              </div>
            </div>

             <!-- adding payment options start  -->
             <hr>

             <div class="form-group">
                 <label for="single-payment-checkbox">
                     <input type="checkbox" id="single-payment-checkbox"> Single Payment
                 </label>
                 
             </div>

             <div class="form-group">
             <label for="multi-payment-checkbox">
                 <input type="checkbox" id="multi-payment-checkbox"> Multi Payment 
             </label>
             </div>

             

             <div id="multi-payment-container"  style="display: none;">
                 <hr>
                         
                             <!-- Payment Mode Multi One  -->
                             
                               <div class="form-group">
                                 <label
                                   class="form-control-label"
                                   for="input-paymentmode-multi-one"
                                   >Payment Mode One</label
                                 >
                                 <select
                                   class="form-control form-control-alternative"
                                   id="input-paymentmode-multi-one"
                                   name="payment_mode_multi_one"
                                   required
                                 >
                                   <option disabled selected>
                                     Choose Payment Mode One
                                   </option>
                                   <option value="Cash">Cash</option>
                                   <option value="UPI">UPI</option>
                                   <option value="Card">Card</option>
                                   <option value="Cheque">Cheque</option>
                                   <option value="Bank Transfer">
                                     Bank Transfer
                                   </option>
                                  
                                 </select>
                               </div>
                               <div class="form-group">
                                 <label for="multi-mode-one-price">Amount to pay [Mode 1]</label>
                                 <input type="number" class="form-control" id="multi-mode-one-price" name="multi_mode_one_price" placeholder="Enter Amount for Payment Mode One" >
                                 </div>

                                 <div class="form-group" id="payment-id-container-multi-one" style="display: none;">
                                     <label class="form-control-label" for="input-paymentid">Payment ID</label>
                                     <input class="form-control form-control-alternative" type="text" id="input-paymentid-multi-one" name="payment-id" disabled>
                                 </div>
                             
                               <div class="form-group">
                                 <button type="button" class="btn bg-gradient-success makePaymentBtn-multi-one" style="display: none;">Make Payment One</button>
                             </div>

                             
                             

                             <!-- Payment Mode Multi Two  -->
                             <hr>
                                 <div class="form-group">
                                   <label
                                     class="form-control-label"
                                     for="input-paymentmode-multi-two"
                                     >Payment Mode Two</label
                                   >
                                   <select
                                     class="form-control form-control-alternative"
                                     id="input-paymentmode-multi-two"
                                     name="payment_mode_multi_two"
                                     required
                                   >
                                     <option disabled selected>
                                       Choose Payment Mode Two
                                     </option>
                                     <option value="Cash">Cash</option>
                                     <option value="UPI">UPI</option>
                                     <option value="Card">Card</option>
                                     <option value="Cheque">Cheque</option>
                                     <option value="Bank Transfer">
                                       Bank Transfer
                                     </option>
                                    
                                   </select>
                                 </div>

                                 <div class="form-group">
                                     <label for="multi-mode-two-price">Amount to pay [Mode 1]</label>
                                     <input type="number" class="form-control" id="multi-mode-two-price" name="multi_mode_two_price" placeholder="Enter Amount for Payment Mode Two" >
                                     
                                 </div>

                                 <div class="form-group" id="payment-id-container-multi-two" style="display: none;">
                                     <label class="form-control-label" for="input-paymentid">Payment ID</label>
                                     <input class="form-control form-control-alternative" type="text" id="input-paymentid-multi-two" name="payment-id" disabled>
                                 </div>

                                 <div class="form-group">
                                   <button type="button" class="btn bg-gradient-success makePaymentBtn-multi-two" style="display: none;">Make Payment Two</button>
                               </div>
                              
             </div>

             <div id="single-payment-container" style="display: none;">
               <hr>
                     <div class="form-group">
                       <label
                         class="form-control-label"
                         for="input-paymentmode"
                         >Payment Mode</label
                       >
                       <select
                         class="form-control form-control-alternative"
                         id="input-paymentmode"
                         name="payment_mode"
                         required
                       >
                         <option disabled selected>
                           Choose Payment Mode
                         </option>
                         <option value="Cash">Cash</option>
                         <option value="UPI">UPI</option>
                         <option value="Card">Card</option>
                         <option value="Cheque">Cheque</option>
                         <option value="Bank Transfer">
                           Bank Transfer
                         </option>
                        
                       </select>
                     </div>
                   
                   
     
                   
                   
                     
                         <div class="form-group" id="payment-id-container" style="display: none;">
                             <label class="form-control-label" for="input-paymentid">Payment ID</label>
                             <input class="form-control form-control-alternative" type="text" id="input-paymentid" name="payment-id" disabled>
                         </div>
                     
                 
           

           
             <div class="form-group">
               <button type="button" class="btn bg-gradient-success" id="pay-button" style="display: none;">Make Payment</button>
           </div>

             
             <!-- adding new payment mode end  -->

            

            </div>
</div>
          </div>

        </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <!-- Add your 'Pay Now' button or any other action buttons here -->
          <button type="submit" class="btn btn-primary" id="payment-button">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- end of modal for payment details  -->

    <div class="row">
        <div class="col-lg-8">
            {% if alert_delivery_boy%}
                <div class="alert alert-info alert-dismissible m-4 fade show" role="alert">
                  <span class="alert-icon text-white"><i class="ni ni-like-2"></i></span>
                  <span class="alert-text text-white"><strong>Info!</strong> {{alert_delivery_boy}}!</span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              {% endif %}
            {% if not query_result%}
                <div class="alert alert-info alert-dismissible m-4 fade show" role="alert">
                  <span class="alert-icon text-white"><i class="ni ni-like-2"></i></span>
                  <span class="alert-text text-white"><strong>Info!</strong> {{error_msg}}!</span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              {% else %}
          <div class="row">
            <div class="col-12">
              <div class="card mb-4">
                <div class="card-header pb-0">
                  <div class="row">
                    <div class="col-6">
                      <h6 class="mb-2">VFF Group</h6>
                      <h6 class="mb-2">Branch Name: {{branch_name}}</h6>
                      <div class="col">
                        <small>{{branch_address}}</small>
                      </div>
                      <div class="col">
                        <small>+91-{{branch_contactno}}</small>
                      </div>
                      <div class="col">
                        <small>{{branch_city}},{{branch_state}} - {{branch_pincode}}</small>
                      </div>
                      <div class="col">
                        <small>Order Taken On : <span class="badge badge-sm bg-gradient-dark">{{order_taken_on}}</span></small>
                    </div>
                    {% if payment_type != 'NA' %}
                      <div class="col">
                        <small>Transaction Type - <span class="badge badge-sm bg-success">{{payment_type}}</span></small>
                    </div>
                    {% endif %}
                     <div class="col">

                     </div>
                      
                    </div>
                    <div class="col-6 d-flex flex-column justify-content-end align-items-end">
                      <h6 class="mb-2"><span class="badge badge-sm bg-dark">Order ID:#{{order_id}}</span></h6>
                      <div class="col">
                        <small>Order Date :{{order_date}}</small>
                      </div>
                      
                      {% if payment_done == 1%}
                      <div class="col mt-1">
                        {% if payment_type != 'Cash' %}  
                        <small>Transaction ID - {{payment_id}}</small>
                        {% else %}
                        <small>Transaction Type - <span class="badge badge-sm bg-success">{{payment_type}}</span></small>
                        {% endif %}  
                      </div>
                      {% endif %}  

                      
                      <div class="col">
                          <small>Delivery Date : {{delivery_date}}</small>
                      </div>
                      
                      <div class="col">
                        {% if wants_delivery == 1 %}
                        <small>Requested Delivery : <span class="badge badge-sm bg-success">Yes</span></small>
                        {% if pickup_done_delivery_boy_name != "" %}
                        <p class=" text-sm m-1">Pickup Done By : <span class="badge badge-sm bg-dark">{{pickup_done_delivery_boy_name}}</span></p>
                        {% endif %}
                        {% if drop_done_delivery_boy_name != "" %}
                        <p  class=" text-sm m-1">Drop Done By : <span class="badge badge-sm bg-primary">{{drop_done_delivery_boy_name}}</span></p>
                        {% endif %}
                        

                        {% else %}
                        <small>Requested Delivery : <span class="badge badge-sm bg-warning">No</span></small>
                        {% endif %}
                    </div>
                      <div class="col mt-1">
                        {% if payment_done == 1 %}
                        <small>Payment Done : <span class="badge badge-sm bg-success">Yes</span></small>
                        {% else %}
                        <small>Payment Done : <span class="badge badge-sm bg-danger">No</span></small>
                        {% endif %}
                    </div>

                      <div class="col mt-1">
                        <p class="">Order : {{order_completed_status}}</p>
                        
                    </div>
                    <div class="col mt-1">
                        <h6 class="mb-1">Order Status : {{order_status}}</h6>
                        
                    </div>
                   
                    </div>
                    
                  </div>
                </div>
                <!-- Action Buttons  -->

                <!-- Action Buttons End  -->
                <div class="card-body px-0 pt-0 pb-2 mt-2">
                  <div class="table-responsive p-0">
                    <table class="table table-bordered align-items-center mb-0  table-hover">
                      <thead class="bg-light">
                        <tr>
                          
                          <th
                            class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 "
                          >
                            Service Name
                          </th>
                          <th
                            class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"
                          >
                            Rate
                          </th>
                          <th
                            class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"
                          >
                            Quantity
                          </th>
                          <th
                            class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"
                          >
                            Total
                          </th>
                          
                        </tr>
                      </thead>
                      {% if not query_result%}
                <div class="alert alert-info alert-dismissible m-4 fade show" role="alert">
                  <span class="alert-icon text-white"><i class="ni ni-like-2"></i></span>
                  <span class="alert-text text-white"><strong>Info!</strong> {{error_msg}}!</span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              {% else %}
                      <tbody>
                        {% for row in query_result %}
                  <tr>
                    
                    <td>
                      <div class="d-flex px-2 py-1">
                        <div>
                        {% if row.type_of == "Kg" %}
                          <img src="{{row.cat_img}}" class="avatar avatar-sm me-3" alt="">
                          {% else %}
                          <img src="{{row.sub_cat_img}}" class="avatar avatar-sm me-3" alt="">
                          {% endif %}
                        </div>
                        <div class="d-flex flex-column justify-content-center" >
                            {% if row.type_of == "Kg" %}
                          <h6 class="mb-0 text-sm">{{row.cat_name}}</h6>
                          <small class="text-secondary">{{sub_items}}</small>
                          {% else %}
                          
                          <h6 class="mb-0 text-sm">{{row.sub_cat_name}}</h6>
                          <p class="text-xs text-blue mb-0">[ {{row.section_type}} ]</p>
                          {% endif %}
                        </div>
                      </div>
                    </td>
                    <td>
                        <p class="text-xs font-weight-bold mb-0">₹ {{row.actual_cost}} /  {{row.type_of}}</p>
                        <small>{{row.ordertype}}</small>
                      </td>
                    <td>
                      {% if row.type_of == "Sqft" %}
                      <p class="text-xs font-weight-bold mb-0">{{row.item_quantity}} Piece</p>
                      <p class="text-xs font-weight-bold mb-0">W-[{{row.square_width}}] H-[{{row.square_height}}] = {{row.total_square_feet}}</p>
                      
                      {% else %}
                      <p class="text-xs font-weight-bold mb-0">{{row.item_quantity}} {{row.type_of}}</p>
                      {% endif %}
                    </td>
                    <td>
                        <h6 class="text-xs font-weight-bold mb-0 text-center">₹ {{row.item_cost}}</h6>
                        
                      </td>
                    
                   
                  </tr>
                  {% endfor %}
                      </tbody>
                      {% endif %}
                    </table>
                  </div>
                </div>
                <div class="card-footer px-4 pt-0 pb-2 mt-2">
                  <div class="row">
                    <div class="col-lg-6">
                      <h6 class="mb-0">Invoice To:</h6>
                      <small class="mb-2">{{customer_name}}</small>
                      <p class="text-xs mb-0 p-1">+91{{mobile_no}}</p>
                      <p class="text-xs mb-0 p-1">{{houseno}} {{address}}, {{city}} {{pincode}}-INDIA</p>
                      
                      
                      
                      
                    </div>
                    <div class="col-lg-6">
                      <h6 class="mb-0">Payment Details:</h6>
                      {% if payment_done == 0 %}

                      <div class="row">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Sub Total </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹{{sub_total}}/-</small>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-lg-12">
                          <button id="printLabelBtn" type="button" class="btn btn-facebook my-4"  data-bs-toggle="modal" data-bs-target="#modal-default1">Make Payment</button>
                        </div>
                      </div>
                      {% else %}
                      <div class="row">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Sub Total </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small  class="text-primary">₹{{sub_total}}/-</small>
                          
                        </div>
                      </div>

                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Addon </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹ {{ extra_item_sum}}/-</small>
                        </div>
                      </div>
                      {% if gst_amount != '0' and gst_amount != '0.0' %}
                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">CGST (9%) [Inclusive]</p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹{{central_gst}}/-</small>
                        </div>
                      </div>

                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">SGST (9%)  [Inclusive] </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹{{state_gst}}/-</small>
                        </div>
                      </div>

                      {% elif igstamount != '0' and igstamount != '0.0' %}
                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Tax IGST (18%) </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹{{igstamount}}/-</small>
                        </div>
                      </div>
                      {% else %}
                      {% endif %}

                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Discount </p>
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹{{discount_amount}}/-</small>
                        </div>
                      </div>
                      <div class="row mb-0">
                        <div class="col-lg-6">
                          <p class="text-xs mb-0 p-1">Delivery Charges </p>
                         
                        </div>
                        <div class="col-lg-6 d-flex flex-column justify-content-end align-items-end">
                          <small class="text-primary">₹ {{delivery_price_taken}}/-</small>
                        </div>
                      </div>
                      <!-- <div class="row mb-0">
                        <p class="mb-2 text-xxs">You will only be charge if your total amount is less then ₹ {{range_price}}</p>
                      </div> -->
                      <hr>
                      <div class="row mb-4">
                        <div class="col-lg-6">
                          <h6 class="mb-0">Gross Total </h6>
                        </div>
                        <div class="col-lg-6  d-flex flex-column justify-content-end align-items-end">
                          <h6 class="text-primary">₹ {{total_cost}}/-</h6>
                        </div>
                      </div>
                      {% endif %}
                      
                      
                    </div>
                  </div>
                   
              </div>

              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="card ">
            <div class="card-header pb-0 p-3">
              <div class="row">
                <div class="col-6 d-flex align-items-center">
                  <h6 class="mb-0">Service Addons</h6>
                </div>
                
              </div>
            </div>
            <div class="card-body p-3 pb-0">
                {% if not extra_data%}
                <div class="alert alert-info alert-dismissible m-4 fade show" role="alert">
                  <span class="alert-icon text-white"><i class="ni ni-like-2"></i></span>
                  <span class="alert-text text-white"><strong>Info!</strong> {{extra_error}}!</span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              {% else %}
              <ul class="list-group">
                {% for row in extra_data %}


                <li
                  class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2  bg-gray-100 border-radius-lg"
                >
                  <div class="d-flex flex-column m-1">
                    <h6 class="text-dark font-weight-bold text-sm ">
                      {{row.extra_item_name}} : ₹ {{row.extra_item_price}}/-
                    </h6>
                    
                  </div>
                 
                </li>
                
                {% endfor %}
                
              </ul>
              {% endif %}
              {% if additional_instruction != 'NA' %}
              <div class="col mb-1">
                <div class="form-group">
                  <label>Additional Instructions </label>
                  <textarea rows="4" class="form-control form-control-alternative" disabled>{{ additional_instruction }}</textarea>
                </div>
              </div>
              {% endif %}
              <div class="row">
                {% if payment_done == 1 %}
                <div class="col-lg-6">
                  <form action="{% url 'dashboard_app:generate_bill' order_id%}" method="post" target="_blank">
                    {% csrf_token %}
                    <button id="printButton" type="submit" class="btn btn-primary my-4">Print Bill</button>
                  </form>
                </div>
                {% endif %}
                <div class="col-lg-6 d-flex justify-content-end align-items-end">
                  <form action="{% url 'dashboard_app:print_label_tags' order_id%}" method="post" target="_blank">
                    {% csrf_token %}
                    <button id="printLabelBtn" type="submit" class="btn btn-facebook my-4">Labels Print</button>
                  </form>
                </div>
              </div>


              

              {% if order_status != 'Completed' %}
              <!-- Add a div for the delivery boys dropdown -->
<div id="deliveryBoyDropdown" style="display: none;">
  <label for="delivery-boy">Select Delivery Boy:</label>
  <select class="form-control" id="delivery-boy" name="delivery-boy-id-selected">
    <!-- Delivery boys will be populated here dynamically -->
  </select>
</div>


              <div class="col">
                <form method="post" action="{% url 'dashboard_app:update_order_status' order_id booking_id%}">
                    {% csrf_token %}
                    <div class="row">
                      <!-- Hidden input field to store the selected delivery boy ID -->
<input type="hidden" id="selectedDeliveryBoyId" name="selectedDeliveryBoyId">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-control-label" for="input-order-status">Change Order Status</label>
                                <input type="hidden" name="order_taken_on" value="{{order_taken_on}}">
                                <input type="hidden" name="delivery_price" value="{{delivery_price_taken}}">
                                <input type="hidden" name="wants_delivery" value="{{wants_delivery}}">
                                <select class="form-control form-control-alternative" id="input-order-status" name="order-status">
                                  {% if wants_delivery == 1  and order_taken_on == 'OnCounter'  %}

                                  
                                  <option value="Processing" {% if order_status == 'Processing' %}selected{% endif %}>Processing</option>
                                  <option value="Ready for Delivery" {% if order_status == 'Ready for Delivery' %}selected{% endif %}>Ready for Delivery</option>
                                  <option value="Out for Delivery" {% if order_status == 'Out for Delivery' %}selected{% endif %}>Out for Delivery</option>
                                  <option value="Returned Delivery" {% if order_status == 'Returned Delivery' %}selected{% endif %}>Returned Delivery</option>
                                  <option value="Completed" {% if order_status == 'Completed' %}selected{% endif %}>Completed</option>
                                  
                                  {% elif order_taken_on == 'OnCounter' %}
                                  <option value="Processing" {% if order_status == 'Processing' %}selected{% endif %}>Processing</option>
                                  <option value="Ready for Delivery" {% if order_status == 'Ready for Delivery' %}selected{% endif %}>Ready for Delivery</option>
                                  <option value="Returned Delivery" {% if order_status == 'Returned Delivery' %}selected{% endif %}>Returned Delivery</option>
                                  <option value="Completed" {% if order_status == 'Completed' %}selected{% endif %}>Completed</option>
                                  
                                  {% else %}
                                  {% comment %} <option value="Accepted"  {% if order_status == 'Accepted' %}selected{% endif %}>Accepted</option>
                                  <option value="Payment Done" {% if order_status == 'Payment Done' %}selected{% endif %}>Payment Done</option>
                                  <option value="Pick Up Done" {% if order_status == 'Pick Up Done' %}selected{% endif %}>Pick Up Done</option>
                                  <option value="Reached Store" {% if order_status == 'Reached Store' %}selected{% endif %}>Reached Store</option> {% endcomment %}
                                  <option value="Processing" {% if order_status == 'Processing' %}selected{% endif %}>Processing</option>
                                  <option value="Ready for Delivery" {% if order_status == 'Ready for Delivery' %}selected{% endif %}>Ready for Delivery</option>
                                  <option value="Out for Delivery" {% if order_status == 'Out for Delivery' %}selected{% endif %}>Out for Delivery</option>
                                  <option value="Returned Delivery" {% if order_status == 'Returned Delivery' %}selected{% endif %}>Returned Delivery</option>
                                  <option value="Completed" {% if order_status == 'Completed' %}selected{% endif %}>Completed</option>
                                  {% if order_status != 'Payment Done'%}
                                  <option value="Cancelled" {% if order_status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                                  {% endif %}
                                  {% endif %}
                                </select>
                              </div>
                        </div>
                        <div class="col m-2">
                            <button type="submit" class="btn btn-primary my-4" ">Update</button>
                        </div>



                    </div>
                </form>
              </div>
              {% endif %}
              <!-- modal code  -->
<!-- <div class="col-md-4">
                    
    <div class="modal fade" id="modal-default{{order_id}}" tabindex="-1" role="dialog" aria-labelledby="modal-default" aria-hidden="true">
      <div class="modal-dialog modal- modal-dialog-centered modal-" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title" id="modal-title-default">Be sure before updating Order Status ?</h6>
            <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="alert  m-4" role="alert">
              <strong>Alert! </strong>Do you want to Update the Status from {{order_status}} to !
          </div>
            
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn bg-gradient-danger">Update</button>
            <button type="button" class="btn btn-link  ml-auto" data-bs-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div> -->
<!-- model code ends  -->
            </div>
          </div>
        
        {% endif %}
        </div>
      </div>
      
  </div>
</main>
<!-- <script>
  document.getElementById('printButton').addEventListener('click', function() {
      // Create a new tab for printing
      var printWindow = window.open('', '', 'width=300,height=300');
      printWindow.location.href = '/admin_dashboard/invoice';
      // Write the invoice content to the new tab
      //printWindow.document.write('<html><head><title>Print Invoice</title></head><body>');
      //printWindow.document.write('<h1>Your Invoice Content</h1>');
      // Add your invoice content here

      // Close the body and HTML tags
      //printWindow.document.write('</body></html>');
      //printWindow.document.close();

// Close the tab when the print dialog is closed
      printWindow.onafterprint = function(event) {
// Close the print window
event.target.close();
};

// Attach the onbeforeprint event handler
printWindow.onbeforeprint = function(event) {
// If the user cancels printing, close the print window
if (event.defaultPrevented) {
printWindow.close();
}
};


      // Print the content
      printWindow.print();

    
  });
</script>
 -->

<script>
    //document.getElementById('printButton').addEventListener('click', function () {
      //  window.print();
    //});
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  

  $(document).ready(function () {

    // Update hidden input field value on delivery boy selection
//$('#delivery-boy').change(function () {
  //var selectedDeliveryBoyId = $(this).val();
  //$('#selectedDeliveryBoyId').val(selectedDeliveryBoyId);
//});

    $('#input-order-status').change(function () {
      var selectedOption = $(this).val();
  
      if (selectedOption === 'Out for Delivery') {
        // Show the delivery boys dropdown
        $('#deliveryBoyDropdown').show();
  
        // Make an AJAX call to fetch delivery boys
        $.ajax({
          url: '/admin_dashboard/get_all_delivery_boys/',
          type: 'GET',
          success: function (response) {
            // Populate the delivery boys dropdown
            var deliveryBoyDropdown = $('#delivery-boy');
            deliveryBoyDropdown.empty(); // Clear previous options
  
            // Add options for each delivery boy
            response.deliveryBoys.forEach(function (deliveryBoy) {
              deliveryBoyDropdown.append(`<option value="${deliveryBoy.delivery_boy_id}">${deliveryBoy.usrname}</option>`);
            });
          },
          error: function (error) {
            console.error('Error fetching delivery boys:', error);
          }
        });
      } else {
        // Hide the delivery boys dropdown if option changes
        $('#deliveryBoyDropdown').hide();
      }
    });
  
    // Form submission validation
    $('form').submit(function (event) {
      var selectedOption = $('#input-order-status').val();
  
      if (selectedOption === 'Out for Delivery') {
        var selectedDeliveryBoy = $('#delivery-boy').val();
        console.log('selectedDeliveryBoy::'+selectedDeliveryBoy);
        // Set the initial value of the hidden input field
      $('#selectedDeliveryBoyId').val(selectedDeliveryBoy);
      var dboy = $('#selectedDeliveryBoyId').val();
      console.log('DeliveryBoy::'+dboy);
        // Check if a delivery boy is selected
        if (!selectedDeliveryBoy) {
          event.preventDefault(); // Prevent form submission
  
          // Show a message (you can replace this with a toast or alert)
          //alert('Please select a delivery boy before processing.');
          showToast('Alert','Please select a Delivery Boy before Processing Further.')
          return;
        }
        //event.preventDefault();
        //return;
      }
    });
  });
  
  // Function to show a toast message
function showToast(message, bodyContent) {
  toastr.warning(bodyContent, message, {
    positionClass: "toast-top-right",
    timeOut: 5e3,
    closeButton: !0,
    debug: !1,
    newestOnTop: !0,
    progressBar: !0,
    preventDuplicates: !0,
    onclick: null,
    showDuration: "300",
    hideDuration: "1000",
    extendedTimeOut: "1000",
    showEasing: "swing",
    hideEasing: "linear",
    showMethod: "fadeIn",
    hideMethod: "fadeOut",
    tapToDismiss: !1
})
    // Get the toast element and its content
    /*var toastElement = document.getElementById("liveToast");
    var toastBody = toastElement.querySelector(".toast-body");

    // Update the toast content with the provided message and body content
    toastBody.textContent = bodyContent;

    // Show the toast
    var toast = new bootstrap.Toast(toastElement);
    toast.show();*/
}


var grossTotal = 0; // Total amount
var subTotal = 0; // Total amount
var grossQuantity = 0; // Total Quantity
var orderTakenOn = ""; // Order Taken On
var order_status = ""; // Order Status
var payment_status = ""; // Payment Status
var isPaymentDone = false; // Payment Done Status true or false
var GSTamount = 0; // Total GST
var IGSTamount = 0; // Total IGST
var addOnsTotal = 0;
var booking_id = -1;
var deliveryTotal = 0;
var discountAmount = 0;
var discountedAmount = 0;
var delivery_price =0;
var delivery_range = 0;
var delivery_charges = 0;
var totalPayment = 0;
var wantsDelivery = 0;
var order_id = '-1';

var payment_id = "-1";
var payment_one_id = "-1";
var payment_two_id = "-1";
var paymentType = "";
var payment_type = "";
var payment_one_type = "NA";
var payment_two_type = "NA";

//Make Payment Controls
$(document).ready(function() {



if(!isNaN(addOnsTotal)){
  $('#addons-total').text('Rs.'+addOnsTotal+'/-');
  }
//if(!isNaN(GSTamount)){
$('#tax-total').text('Rs.0/-');
//  }

  if(!isNaN(delivery_charges)){
      $('#delivery-charges').text('Rs.0/-');
  }
  $('#delivery-input').val('');
  $('#discounted-input').val('');
  if(!isNaN(discountAmount)){
    $('#discount-amount').text('Rs.0/-');
  }
// Get the element by its ID
const subtotalElement = document.getElementById('subtotal').value;
order_id = document.getElementById('orderid').value;

// Extract the text content from the HTML element
const subTotalText = parseFloat(subtotalElement);

  subTotal = subTotalText;
  console.log('subTotalText::'+subTotalText);
  grossTotal = subTotal;
  $('#sub-total').text('Rs.'+subTotal.toFixed(2)+'/-');
  $('#gross-total').text('Rs.'+grossTotal+'/-');

  //Delivery Charges Calculation
  var deliverySum = 0;
    
  $('#delivery-input').on('input', function() {

    delivery_charges = parseFloat($(this).val());
    console.log('delivery_charges::'+delivery_charges);
    // Update the discounted amount
    
    console.log('deliverySum::'+deliverySum);
    if(delivery_charges === "" || isNaN(delivery_charges)){
      delivery_charges = 0;
        $('#delivery-charges').text('Rs.'+delivery_charges+'/-');
        deliverySum = delivery_charges;  
    }
    if(!isNaN(delivery_charges)){
      $('#delivery-charges').text('Rs.'+delivery_charges+'/-');
      deliverySum = delivery_charges;
        }

    if(discountedAmount !== 0 && !isNaN(discountedAmount)){
      discountedAmount= initialGrossTotal + delivery_charges;
        $('#gross-total').text('Rs.'+discountedAmount.toFixed(2)+'/-');
        }else{
          grossTotal = initialGrossTotal +delivery_charges;
            $('#gross-total').text('Rs.'+grossTotal.toFixed(2)+'/-');
        }
});

                // Attach an event listener to the discount input
                $('#discounted-input').on('input', function() {
                  discount = parseFloat($(this).val());
      
                  // Calculate the discounted amount
                  //discountedAmount = (grossTotal - (grossTotal * (discount / 100))).toFixed(2);
                  // Check if the discount is 100%
          if (discount === 100.0) {
            discountedAmount = 0; // Set the discounted amount to 0 if the discount is 100%
        } else {
            discountedAmount = (grossTotal - (grossTotal * (discount / 100))).toFixed(2);
        }
                  
                  discountAmount = (grossTotal * (discount / 100)).toFixed(2);
                  discountAmount = parseFloat(discountAmount).toFixed(2);
      
                  console.log("discountAmount::"+(grossTotal * (discount / 100)));
                  // Update the discounted amount
                  discountedAmount = grossTotal - discountAmount;
                  if(discount === "" || isNaN(discount)){
                      discountAmount = 0;
                      $('#discount-amount').text('Rs.'+discountAmount+'/-');
                      
                  }
                  if(!isNaN(discountAmount)){
                      $('#discount-amount').text('Rs.'+discountAmount+'/-');
                      }
      
                  if(discountedAmount !== 0 && !isNaN(discountedAmount)){
                    initialGrossTotal = discountedAmount;
                      $('#gross-total').text('Rs.'+discountedAmount.toFixed(2)+'/-');
                      }else{
                        initialGrossTotal = grossTotal;
                          $('#gross-total').text('Rs.'+grossTotal.toFixed(2)+'/-');
                      }
              });

              //IF Discounted Amount is removed
              if(discountedAmount !== 0 && !isNaN(discountedAmount)){
                initialGrossTotal = discountedAmount;
                  $('#gross-total').text('Rs.'+discountedAmount.toFixed(2)+'/-');
      
                  }else{
                    initialGrossTotal = grossTotal;
                      $('#gross-total').text('Rs.'+grossTotal.toFixed(2)+'/-');
                  }
            
              //Pay now button click
              document.getElementById('pay-button').onclick = function(e){

                console.log('Before_Gross_total::'+grossTotal);
            console.log('Before_delivery_charges::'+delivery_charges);
            console.log('Before_addOnsTotal::'+addOnsTotal);
            if(discountedAmount !== 0 && !isNaN(discountedAmount)){
                totalPayment = parseFloat(discountedAmount).toFixed(0);
            }else{
                
                totalPayment = parseFloat(grossTotal).toFixed(0);
            }
            
            
                payment_show(totalPayment);
                //TODO:Need to save Razor Pay Payment ID.
                console.log('razor_pay_id::'+payment_id);
                
                e.preventDefault();
            }

       

});
//End of Payment Controls

function payment_show(totalPayment){
  console.log('PaytotalPayment::'+totalPayment);
  var options = {
    
      "key": "rzp_test_qtHIWapeUEAAZO", // Enter the Key ID generated from the Dashboard rzp_test_qtHIWapeUEAAZO
      "amount": (totalPayment * 100), // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "VFF Group", //your business name
      "description": "Laundry Service Charges",
      "image": "https://vff-group.com/static/images/logo.png",
      "handler": function (response){
          payment_id =  response.razorpay_payment_id;
          order_status = "Payment Done";
          payment_status = "Success";
          isPaymentDone = true;
          //GSTamount = 0
          //IGSTamount = 0
          //GSTamount = ((totalPayment * 18)/100);
          //var gstAmountLabel = $('#tax-total');
          //gstAmountLabel.text('Rs.' + GSTamount.toFixed(2) + '/-');
          
          // Update the payment ID input
          $('#input-paymentid').val(payment_id);
          disableElements();
          //alert(response.razorpay_payment_id);
          //alert(response.razorpay_order_id);
          //alert(response.razorpay_signature)
      },
      
      "notes": {
          "address": "Tilakwadi"
      },
      "theme": {
          "color": "#3399cc"
      }
  };
  var rzp1 = new Razorpay(options);
  rzp1.on('payment.failed', function (response){
        //  alert(response.error.code);
          alert(response.error.description);
          //alert(response.error.source);
          //alert(response.error.step);
          //alert(response.error.reason);
         // alert(response.error.metadata.order_id);
          //alert(response.error.metadata.payment_id);
  });
  rzp1.open();
  /*document.getElementById('pay-button').onclick = function(e){
      rzp1.open();
      e.preventDefault();
  }*/
}

// Event listener for GST checkbox
$('#includeGST').change(function() {
updateTaxAmount();
});

// Event listener for IGST checkbox
$('#includeIGST').change(function() {
updateTaxAmount();
});

// Function to update tax amount based on checkbox state
function updateTaxAmount() {
if(discountedAmount !== 0 && !isNaN(discountedAmount)){
totalPayment = parseFloat(discountedAmount).toFixed(2);
grossTotal = discountedAmount;
}else{

totalPayment = parseFloat(grossTotal).toFixed(2);
}
//totalPayment = parseFloat(subTotal).toFixed(2);  
var gstCheckbox = $('#includeGST');
var igstCheckbox = $('#includeIGST');
var gstAmountLabel = $('#tax-total');
var gstTotal = 0;
// Check if either GST or IGST is selected 
if (gstCheckbox.prop('checked') || igstCheckbox.prop('checked')) {

// Calculate GST amount
if(igstCheckbox.prop('checked')){
GSTamount = 0;
gstTotal = 0;
igstCheckbox.prop('disabled',false);
gstCheckbox.prop('disabled',true);
IGSTamount = (totalPayment * 18) / 100;  
gstTotal = IGSTamount;
IGSTamount = parseFloat(IGSTamount).toFixed(2)
//if(discountedAmount !== 0 && !isNaN(discountedAmount)){
//discountedAmount -=gstTotal
//}else{
//grossTotal -= gstTotal;
//}
}else{
IGSTamount = 0;
gstTotal = 0;
gstCheckbox.prop('disabled',false);
igstCheckbox.prop('disabled',true);
GSTamount = (totalPayment * 18) / 100;
gstTotal = GSTamount;
GSTamount = parseFloat(GSTamount).toFixed(2)
//if(discountedAmount !== 0 && !isNaN(discountedAmount)){
//discountedAmount -=gstTotal
//}else{
//grossTotal -= gstTotal;
//}
}


gstAmountLabel.text('Rs.' + gstTotal.toFixed(2) + '/-');
//$('#gross-total').text('Rs.'+grossTotal.toFixed(2)+'/-');
} else {
gstAmountLabel.text('Rs.0/-');

if(GSTamount !== 0){
IGSTamount = 0;
igstCheckbox.prop('disabled',false);
//if(discountedAmount !== 0 && !isNaN(discountedAmount)){
//discountedAmount -=GSTamount;
//}else{
// grossTotal -= GSTamount;
// }

}else{
GSTamount = 0;
gstCheckbox.prop('disabled',false);
//if(discountedAmount !== 0 && !isNaN(discountedAmount)){
//discountedAmount -=IGSTamount;
//}else{
//grossTotal -= IGSTamount;
//}
}


//if(discountedAmount !== 0 && !isNaN(discountedAmount)){

//$('#gross-total').text('Rs.'+discountedAmount.toFixed(2)+'/-');
//}else{
//$('#gross-total').text('Rs.'+grossTotal.toFixed(2)+'/-');
//}
}




}

$("#pay-button").click(function(e) {
// Check if payment mode is not selected
if ($("#input-paymentmode").val() === "Choose Payment Mode") {
// Add the "is-invalid" class to the payment mode dropdown
$("#input-paymentmode").addClass("is-invalid");
// You can also show an error message or perform other actions

// Prevent the form submission

e.preventDefault();
} else {
// If a valid selection is made, add the "is-valid" class
$("#input-paymentmode").removeClass("is-invalid").addClass("is-valid");
}
});



// Event listener for the payment mode selection
$('#input-paymentmode').change(function() {
var paymentMode = $(this).val();
var paymentIdContainer = $('#payment-id-container');
var gstContainer = $('#gst-container');
paymentType = paymentMode;
// Check if the payment mode is 'Cash' and hide the 'Pay Now' button
if (paymentMode === 'Cash' || paymentMode === 'Cheque') {
order_status = "Payment Done";
isOnlinePayment = false;
paymentSuccessful = true;
payment_status = "Success";
$('#pay-button').hide();
//gstContainer.show();
// If the payment mode is "Cash," hiding the payment ID container
paymentIdContainer.hide();
} else if(paymentMode === 'Pay Later'){
order_status = "Payment Not Done";
payment_status = "Not Success";

}else {
$('#pay-button').show();
//gstContainer.hide();
// If the payment mode is not "Cash," show the payment ID container
paymentIdContainer.show();
}
});

// Function to disable elements
function disableElements() {
// Disable "Pay Now" button
$("#pay-button").prop("disabled", true);

// Disable payment mode select dropdown
$("#input-paymentmode").prop("disabled", true);

// Disable discount input box
$("#discounted-input").prop("disabled", true);

// Disable Cancel
$("#cancel-btn").prop("disabled", true);

//Disable Delivery Charges Input Box
$("#delivery-input").prop("disabled", true);
}

// Initialize form validation for your form
$('#order-form').validate({
  rules: {
     
      'input-paymentmode': 'required',
      // Add rules for other form fields
  },
  messages: {
      
      'input-paymentmode': 'Please select a payment mode',
      // Add custom error messages for other fields
  },
  errorClass: 'is-invalid',
  validClass: 'is-valid',
  errorElement: 'div', // Use a custom error element, e.g., div
  errorPlacement: function(error, element) {
      // Handle error placement as needed
      // You can add error messages where you prefer
      // Example: error.appendTo(element.parent());
  },
  highlight: function(element, errorClass, validClass) {
      // Highlight the field with missing input
      // Remove valid class and add invalid class
      $(element).removeClass(validClass).addClass(errorClass);
  },
  unhighlight: function(element, errorClass, validClass) {
      // Unhighlight the field with valid input
      // Remove invalid class and add valid class
      $(element).removeClass(errorClass).addClass(validClass);
  },
  submitHandler: function(form) {
      // When the form is valid, handle the form submission here
      event.preventDefault();
    
      
  
  var payment_id = $("#input-paymentid").val();
 

var paymentModeSelect = document.getElementById('input-paymentmode');

// Check if payment mode is not equal to 'Cash'
if (paymentModeSelect.value !== 'Cash' ) {
if (payment_id === '') {
  showToast('Alert', 'Please Pay before placing the order as you have selected Payment Mode Other than Cash');
  return;
}
}

if(order_id ==='-1'){
  showToast('Alert', 'Order ID Not Found Please Refresh the page');
  return;
}


  

  if(discountedAmount !== 0 && !isNaN(discountedAmount)){
    totalPayment = parseFloat(discountedAmount).toFixed(0);
}else{
    
    totalPayment = parseFloat(grossTotal).toFixed(0);
}
  if(totalPayment == 0){
    showToast('Alert','Total is 0');
      return;
  }

     //Multiple Payments Only
     if(payment_type === 'Multiple'){
      payment_method = 'Multiple'
      payment_status = 'Success'
      var payment_one_amount = $('#multi-mode-one-price').val();
      var payment_two_amount = $('#multi-mode-two-price').val();
      console.log('payment_one_amount::'+payment_one_amount);

      if(payment_one_type === 'NA'){
          showToast('Alert','Please Select Payment Mode One For Payment');
          return;
       }
  
       if (payment_one_amount === '' || payment_one_amount === undefined){
          showToast('Alert','Please Add The Payment One Amount');
          return;
       }
  
       if (payment_one_id === '-1' && payment_one_type !== 'Cash'){
          showToast('Alert','Please Pay Payment Mode One Amount');
          return;
       }
       if(payment_two_type === 'NA'){
          showToast('Alert','Please Select Payment Mode Two For Payment');
          return;
       }
  
       if (payment_two_amount === '' || payment_two_amount === undefined){
          showToast('Alert','Please Add The Payment Two Amount');
          return;
       }
  
       if (payment_two_id === '-1' && payment_two_type !== 'Cash'){
          showToast('Alert','Please Pay Payment Mode Two Amount');
          return;
       }

   }

   //Single Payments Only
   if(payment_type ==='Single' && payment_status === ''){
    showToast('Alert','Please pay before updating');
    return;
 }

    if (payment_type ==='Single' && !paymentSuccessful) {
        // Show an error message or take appropriate action
        showToast('Alert','Payment not successful. Please try again');
        return;
    }

      // Create a JSON object with the form data
      const dictMap = {
          'order_id': order_id,
          'delivery_price': delivery_charges,
          'discount_price': discountAmount,
          'total_price': totalPayment,
          'order_status': "Payment Done",
          'gstamount': GSTamount,
          'igstamount': IGSTamount,
          'razor_pay_id': payment_id,
          'payment_status': payment_status,
          'payment_mode': paymentType,//If Single Payment Mode Cash or UPI
          
            'payment_type': payment_type, //Single or Multi Payments
            'payment_one_amount': payment_one_amount, //Payment One Amount
            'payment_two_amount': payment_two_amount, //Payment Two Amount
            'payment_one_id': payment_one_id, //Payment One Amount
            'payment_two_id': payment_two_id, //Payment Two Amount
            'payment_one_type': payment_one_type, //Payment One Amount
            'payment_two_type': payment_two_type, //Payment Two Amount
          // Add other form fields to the JSON object
      };
      console.log('dictMap::'+JSON.stringify(dictMap));
    return;
      
      // Perform an AJAX POST request
      
      const csrfToken = getCSRFToken();
      $.ajax({
          type: 'POST',
          url: '/admin_dashboard/update_payment_details_for_order/', 
          data: JSON.stringify(dictMap),
      headers: {
          'X-CSRFToken': csrfToken  // Include the CSRF token in the headers
      },
      contentType: 'application/json',
          success: function (data) {
             console.log('Success:'+JSON.stringify(data.html))

             // Redirect to the "all counter orders" URL
            window.location.replace('/admin_dashboard/all_orders/');

  // Open a new tab for printing
  //var newTab = window.open();
  //newTab.document.write(data.html);

  // Listen for the beforeunload event to close the tab if canceled
  //newTab.onbeforeunload = function (e) {
      // Close the tab when the user tries to close it
    //  newTab.close();
  //};
          },
          error: function (error) {
              console.error('Error:', error);
          }
      });
  
      
  }
});

// Get the CSRF token from the cookie
function getCSRFToken() {
  const cookies = document.cookie.split(';');
  for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith("csrftoken=")) {
          return cookie.substring("csrftoken=".length, cookie.length);
      }
  }
  return null;
}

//New Payment Handling Setup 
  //Handling Payment Mode i.e Single or Multiple 
  document.getElementById('single-payment-checkbox').addEventListener('change', function() {
    const multiPaymentCheckbox = document.getElementById('multi-payment-checkbox');
        if (this.checked) {
            payment_type="Single";
            document.getElementById('single-payment-container').style.display = 'block';
            document.getElementById('multi-payment-container').style.display = 'none';
            document.querySelector('.makePaymentBtn').style.display = 'block';
            multiPaymentCheckbox.disabled = true;
        } else {
            payment_type="";
            document.getElementById('single-payment-container').style.display = 'none';
            document.querySelector('.makePaymentBtn').style.display = 'none';
            multiPaymentCheckbox.disabled = false;
        }
    });

    document.getElementById('multi-payment-checkbox').addEventListener('change', function() {
        const singlePaymentCheckbox = document.getElementById('single-payment-checkbox');
        if (this.checked) {
            payment_type="Multiple";
            document.getElementById('multi-payment-container').style.display = 'block';
            document.getElementById('single-payment-container').style.display = 'none';
            document.querySelector('.makePaymentBtn').style.display = 'block';
            singlePaymentCheckbox.disabled = true;
        } else {
            payment_type="";
            document.getElementById('multi-payment-container').style.display = 'none';
            document.querySelector('.makePaymentBtn').style.display = 'none';
            singlePaymentCheckbox.disabled = false;
        }
    });

    //Multi Payment One Payment Method handling Cash or Online to show Make Payment button
    $(document).ready(function() {
        $('#input-paymentmode-multi-one').change(function() {
            var selectedPaymentMode = $(this).val();
            var makePaymentBtn = $('.makePaymentBtn-multi-one');
            payment_one_type = selectedPaymentMode;

            if (selectedPaymentMode === 'Cash' || selectedPaymentMode === 'Cheque') {
                
                makePaymentBtn.hide();
                document.getElementById('payment-id-container-multi-one').style.display = 'none';
            } else {
                makePaymentBtn.show();
                
                document.getElementById('payment-id-container-multi-one').style.display = 'block';
            }
        });
    });

    //Multi Payment Two Payment Method handling Cash or Online to show Make Payment button
    $(document).ready(function() {
        $('#input-paymentmode-multi-two').change(function() {
            var selectedPaymentMode = $(this).val();
            var makePaymentBtn = $('.makePaymentBtn-multi-two');
            payment_two_type = selectedPaymentMode;

            if (selectedPaymentMode === 'Cash' || selectedPaymentMode === 'Cheque') {
                makePaymentBtn.hide();
                document.getElementById('payment-id-container-multi-two').style.display = 'none';
           
            } else {
                makePaymentBtn.show();
                document.getElementById('payment-id-container-multi-two').style.display = 'block';
            }
        });
    });


    //to make button one payment 
        $(document).ready(function() {
            $('.makePaymentBtn-multi-one').click(function() {
                var amount = $('#multi-mode-one-price').val(); // Amount in paise/cents
                amount = parseFloat(amount);


                var options = {
                    "key": "rzp_test_qtHIWapeUEAAZO", // Enter the Key ID generated from the Dashboard      rzp_test_qtHIWapeUEAAZO
                    "amount": (amount * 100), // Amount is in currency subunits. Default currency is INR. Hence, 50000      refers to 50000 paise
                    "currency": "INR",
                    "name": "Velvet Wash Laundry", //your business name
                    "description": "Laundry Service Charge",
                    "image": "https://vff-group.com/static/images/logo.png",
                    handler: function(response) {
                        $('#input-paymentid-multi-one').val(response.razorpay_payment_id);
                        payment_one_id = response.razorpay_payment_id;
                    },
                    "notes": {
                        "address": "Tilakwadi"
                    },
                    theme: {
                        color: '#F37254'
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            });
        });

        //to make button two payment
        $(document).ready(function() {
            $('.makePaymentBtn-multi-two').click(function() {
                var amount = $('#multi-mode-two-price').val(); // Amount in paise/cents
                amount = parseFloat(amount);


                var options = {
                    "key": "rzp_test_qtHIWapeUEAAZO", // Enter the Key ID generated from the Dashboard      rzp_test_qtHIWapeUEAAZO
                    "amount": (amount * 100), // Amount is in currency subunits. Default currency is INR. Hence, 50000      refers to 50000 paise
                    "currency": "INR",
                    "name": "Velvet Wash Laundry", //your business name
                    "description": "Laundry Service Charge",
                    "image": "https://vff-group.com/static/images/logo.png",
                    handler: function(response) {
                        $('#input-paymentid-multi-two').val(response.razorpay_payment_id);
                        payment_two_id = response.razorpay_payment_id;
                   
                    },
                    "notes": {
                        "address": "Tilakwadi"
                    },
                    theme: {
                        color: '#F37254'
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            });
        });


   
    //new payment handling setup End 

</script>


{% endblock  %}

